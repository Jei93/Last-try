<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gaming Analytics & Cybersecurity | Dashboard IA</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<script src="https://js.puter.com/v2/"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* ========== ESTILOS BASE (DARK THEME) ========== */
:root {
  --bg-primary: #0F172A;
  --bg-secondary: #1E293B;
  --bg-card: #1E293B;
  --text-primary: #F1F5F9;
  --text-secondary: #94A3B8;
  --accent-aaa: #EF4444;
  --accent-aa: #F59E0B;
  --accent-indie: #10B981;
  --border: #334155;
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  --card-radius: 16px;
  --muted: #9fdcff;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

/* ========== SISTEMA DE PESTA√ëAS ========== */

.tab-container {
  max-width: 1600px;
  margin: 0 auto;
  padding: 20px;
}

.tab-nav {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  background: var(--bg-card);
  padding: 10px;
  border-radius: 12px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
}

.tab-button {
  background: var(--bg-primary);
  border: 1px solid var(--border);
  color: var(--text-secondary);
  padding: 12px 24px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.tab-button.active {
  background: #3B82F6;
  color: white;
  border-color: #3B82F6;
}

.tab-button:hover:not(.active) {
  background: var(--bg-secondary);
  color: var(--text-primary);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* ========== ESTILOS GAMING DASHBOARD (ORIGINALES) ========== */
.gaming-dashboard {
  max-width: 1600px;
  margin: 0 auto;
}

header.gaming {
  background: linear-gradient(135deg, var(--bg-secondary), #2563EB);
  padding: 30px;
  border-radius: 16px;
  margin-bottom: 30px;
  box-shadow: var(--shadow);
  position: relative;
}

header.gaming h1 {
  font-size: 2.5rem;
  font-weight: 800;
  margin-bottom: 10px;
  background: linear-gradient(to right, #FFF, #93C5FD);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.subtitle { color: var(--text-secondary); font-size: 1.1rem; }

.controls-panel {
  background: var(--bg-card);
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 30px;
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  align-items: center;
  border: 1px solid var(--border);
}

/* ... estilos continuados ... */

.filter-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

label {
  font-size: 0.875rem;
  color: var(--text-secondary);
  font-weight: 500;
}

select, input[type="range"], .search-box {
  background: var(--bg-primary);
  border: 1px solid var(--border);
  color: var(--text-primary);
  padding: 10px 14px;
  border-radius: 8px;
  font-size: 0.9rem;
}

.btn {
  background: #3B82F6;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s;
}

.btn:hover { background: #2563EB; transform: translateY(-1px); }

.btn-secondary {
  background: var(--bg-primary);
  border: 1px solid var(--border);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
  gap: 25px;
  margin-bottom: 30px;
}

.chart-card {
  background: var(--bg-card);
  padding: 25px;
  border-radius: 12px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  position: relative;
}

.chart-card h3 {
  font-size: 1.25rem;
  margin-bottom: 20px;
  color: var(--text-primary);
  font-weight: 600;
}

.chart-container {
  position: relative;
  height: 300px;
}

.full-width { grid-column: 1 / -1; }

.metrics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.metric-card {
  background: var(--bg-card);
  padding: 25px;
  border-radius: 12px;
  border-left: 4px solid var(--accent-indie);
  box-shadow: var(--shadow);
}

.metric-card.aaa { border-left-color: var(--accent-aaa); }
.metric-card.aa { border-left-color: var(--accent-aa); }

.metric-value {
  font-size: 2.5rem;
  font-weight: 800;
  margin-bottom: 5px;
}

.metric-label {
  color: var(--text-secondary);
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.metric-change {
  font-size: 0.875rem;
  margin-top: 8px;
  padding: 4px 8px;
  border-radius: 4px;
  display: inline-block;
}

.positive { background: rgba(16, 185, 129, 0.1); color: #10B981; }
.negative { background: rgba(239, 68, 68, 0.1); color: #EF4444; }

.trend-indicator {
  display: inline-block;
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  margin-left: 8px;
}

.trend-up { border-bottom: 10px solid #10B981; }
.trend-down { border-top: 10px solid #EF4444; }

.data-table-section {
  background: var(--bg-card);
  padding: 25px;
  border-radius: 12px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  margin-top: 30px;
}

.table-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 15px;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
}

th, td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid var(--border);
}

th {
  background: var(--bg-primary);
  font-weight: 600;
  color: var(--text-secondary);
  position: sticky;
  top: 0;
}

tr:hover { background: rgba(255, 255, 255, 0.02); }

.insights-panel {
  background: linear-gradient(135deg, #1E3A8A, #3B82F6);
  padding: 25px;
  border-radius: 12px;
  margin-top: 30px;
  color: white;
}

.insights-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.insight-card {
  background: rgba(255, 255, 255, 0.1);
  padding: 20px;
  border-radius: 8px;
  backdrop-filter: blur(10px);
}

.insight-card h4 {
  margin-bottom: 10px;
  font-size: 1.1rem;
}

.ia-mode-indicator {
  position: absolute;
  top: 20px;
  right: 20px;
  background: linear-gradient(45deg, #EF4444, #F59E0B);
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 0.875rem;
  font-weight: 700;
  color: white;
  display: none;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: #3B82F6;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ========== ESTILOS CIBERSEGURIDAD (ORIGINALES) ========== */
.cyber-page {
  min-height: 100vh;
  padding: 48px 20px 88px;
  background: linear-gradient(120deg, rgba(10,30,60,0.98), rgba(2,10,30,0.98));
  position: relative;
  overflow: hidden;
  perspective: 1600px;
}

.cyber-page::before {
  content: "";
  position: fixed;
  inset: -25% -25% -25% -25%;
  z-index: -2;
  background: conic-gradient(from 0deg at 50% 50%, #ff004d, #ff8a00, #ffee00, #00ff9d, #00b2ff, #9a00ff, #ff004d);
  background-size: 220% 220%;
  filter: blur(44px) saturate(200%);
  opacity: 0.18;
  transform: scale(1.02);
  animation: spin 20s linear infinite;
  mix-blend-mode: screen;
}

@keyframes spin {
  0% { transform: rotate(0); }
  50% { transform: rotate(180deg) scale(1.02); }
  100% { transform: rotate(360deg); }
}

.float-shape {
  position: absolute;
  width: 220px;
  height: 220px;
  border-radius: 32px;
  filter: blur(40px);
  opacity: 0.08;
  z-index: -1;
}

.s1 {
  right: 6%;
  top: 4%;
  background: linear-gradient(45deg, #00f0ff66, #7b61ff66);
  animation: floaty 10s ease-in-out infinite;
}

.s2 {
  left: 4%;
  bottom: 6%;
  background: linear-gradient(45deg, #ff6a8866, #ffd27a66);
  animation: floaty 14s ease-in-out infinite reverse;
}

@keyframes floaty {
  0% { transform: translateY(0) rotate(0); }
  50% { transform: translateY(-30px) rotate(8deg); }
  100% { transform: translateY(0) rotate(0); }
}

header.cyber {
  max-width: 1100px;
  margin: 0 auto 18px;
  padding: 6px 18px;
}

.cyber-title {
  font-size: 3.4rem;
  margin: 0;
  line-height: 1;
  font-weight: 900;
  letter-spacing: -0.02em;
  background: linear-gradient(90deg, #00f5ff, #7b61ff, #ff6a88, #ffd27a, #7effb2, #00f5ff);
  background-size: 420% 100%;
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  animation: hueShift 4.6s linear infinite, titleBeams 3.6s ease-in-out infinite;
  text-shadow: 0 12px 56px rgba(123, 97, 255, 0.22), 0 36px 160px rgba(255, 106, 136, 0.08), 0 0 260px rgba(0, 245, 255, 0.09);
  filter: saturate(1.55) contrast(1.05);
}

@keyframes hueShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes titleBeams {
  0% { filter: brightness(1) saturate(1.4); }
  30% { filter: brightness(1.35) saturate(1.6) drop-shadow(0 8px 36px rgba(255, 255, 255, 0.06)); }
  60% { filter: brightness(1.6) saturate(1.8) drop-shadow(0 18px 90px rgba(255, 106, 136, 0.09)); }
  100% { filter: brightness(1.4) saturate(1.4); }
}

.cyber-subtitle {
  margin-top: 12px;
  color: var(--muted);
  font-size: 1rem;
  max-width: 980px;
}

.cyber-grid {
  max-width: 1100px;
  margin: 28px auto 0;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 18px;
}

.cyber-card {
  padding: 18px;
  border-radius: calc(var(--card-radius) + 4px);
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(0, 0, 0, 0.02));
  border: 1px solid rgba(255, 255, 255, 0.035);
  box-shadow: 0 14px 36px rgba(2, 10, 20, 0.52);
  color: var(--light);
  display: flex;
  flex-direction: column;
  gap: 10px;
  min-height: 120px;
  transition: transform 0.28s cubic-bezier(0.2, 0.9, 0.2, 1), box-shadow 0.28s, filter 0.28s;
  transform-origin: center center;
  opacity: 0;
  transform: translateY(14px) scale(0.99);
  position: relative;
  will-change: transform;
  transform-style: preserve-3d;
  cursor: default;
  overflow: visible;
}

.cyber-card.visible {
  opacity: 1;
  transform: translateY(0) scale(1);
  animation: popIn 0.6s cubic-bezier(0.2, 0.9, 0.2, 1);
}

@keyframes popIn {
  0% { opacity: 0; transform: translateY(10px) scale(0.992) rotateX(6deg); }
  60% { transform: translateY(-6px) scale(1.02) rotateX(0); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

.cyber-card.dance { animation: danceXy 4.8s ease-in-out infinite; }

@keyframes danceXy {
  0% { transform: translateX(calc(var(--dance-range, 8px) * -1)) translateY(0) rotate(-0.6deg); }
  50% { transform: translateX(calc(var(--dance-range, 8px))) translateY(2px) rotate(0.8deg); }
  100% { transform: translateX(calc(var(--dance-range, 8px) * -1)) translateY(0) rotate(-0.6deg); }
}

.cyber-card:hover {
  transform: translateY(-18px) scale(1.06) rotateZ(-0.8deg);
  box-shadow: 0 46px 100px rgba(0, 0, 0, 0.68), 0 0 38px rgba(255, 106, 136, 0.06) inset;
  filter: brightness(1.04) saturate(1.08);
  z-index: 6;
}

.cyber-card::after {
  content: "";
  position: absolute;
  left: -12%;
  top: -20px;
  width: 124%;
  height: 200%;
  pointer-events: none;
  background: radial-gradient(500px 120px at 20% 10%, rgba(255, 255, 255, 0.04), transparent 12%), linear-gradient(90deg, rgba(255, 255, 255, 0.02), transparent 40%);
  transform: translateY(6px) rotate(2deg);
  opacity: 0;
  transition: opacity 0.32s, transform 0.5s;
  border-radius: inherit;
  mix-blend-mode: screen;
}

.cyber-card:hover::after {
  opacity: 1;
  transform: translateY(-6px) rotate(-0.5deg);
}

.cyber-icon {
  font-size: 28px;
  color: transparent;
  width: 54px;
  height: 54px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 12px;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.02));
  border: 1px solid rgba(255, 255, 255, 0.03);
  position: relative;
  z-index: 2;
}

.cyber-icon i {
  color: #00f0ff;
  transition: transform 0.32s cubic-bezier(0.2, 0.9, 0.2, 1), color 0.28s, text-shadow 0.28s;
  font-size: 20px;
}

.cyber-card:hover .cyber-icon i {
  transform: translateY(-8px) scale(1.12) rotate(-8deg);
  color: #ff3d9a;
  text-shadow: 0 8px 24px rgba(255, 106, 136, 0.14);
}

.cyber-card h3 {
  margin: 0;
  font-size: 1.05rem;
  color: #fff;
  font-weight: 900;
  letter-spacing: 0.005em;
  position: relative;
  z-index: 2;
  background: linear-gradient(90deg, #ffd27a, #ff6a88, #7b61ff);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  filter: saturate(1.25);
  text-shadow: 0 6px 24px rgba(255, 106, 136, 0.06);
}

.cyber-card p {
  margin: 0;
  color: #dff7fb;
  line-height: 1.45;
  font-size: 0.95rem;
  position: relative;
  z-index: 2;
}

.section-title {
  font-size: 1.6rem;
  margin: 36px auto 8px;
  max-width: 1100px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  font-weight: 900;
  background: linear-gradient(90deg, #00f5ff, #7b61ff, #ff6a88, #ffd27a, #7effb2);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  text-shadow: 0 10px 48px rgba(123, 97, 255, 0.16), 0 30px 140px rgba(255, 106, 136, 0.07);
  text-align: center;
  filter: saturate(1.45);
}

.section-sub {
  max-width: 1100px;
  margin: 0 auto 18px;
  color: rgba(200, 240, 255, 0.95);
  text-align: center;
}

.lightbox {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(2, 6, 12, 0.82);
  z-index: 1600;
  padding: 24px;
}

.lightbox.active { display: flex; }

.lightbox .frame {
  margin: auto;
  width: min(1100px, 92%);
  height: min(720px, 86%);
  background: linear-gradient(180deg, #000, #060606);
  border-radius: 16px;
  overflow: hidden;
  position: relative;
  box-shadow: 0 40px 140px rgba(0, 0, 0, 0.85), 0 0 80px rgba(123, 97, 255, 0.06);
  transform-origin: center center;
  animation: lbPop 0.28s cubic-bezier(0.2, 0.9, 0.2, 1);
  display: flex;
  align-items: center;
  justify-content: center;
}

.lightbox iframe {
  width: 100%;
  height: 100%;
  border: 0;
  display: block;
  background: #000;
}

.lightbox .close {
  position: absolute;
  right: 14px;
  top: 14px;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02));
  color: #fff;
  border-radius: 10px;
  padding: 10px 12px;
  border: 0;
  cursor: pointer;
  z-index: 5;
  backdrop-filter: blur(6px);
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
}

.refs {
  max-width: 1100px;
  margin: 28px auto 0;
  padding: 18px;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.02);
  border: 1px solid rgba(255, 255, 255, 0.03);
  color: var(--muted);
}

.refs a { color: #00f0ff; text-decoration: underline; }

@media (max-width: 768px) {
  .dashboard-grid { grid-template-columns: 1fr; }
  .controls-panel { flex-direction: column; align-items: stretch; }
  .title { font-size: 1.9rem; }
  .cyber-title { font-size: 2.5rem; }
  .tab-nav { flex-wrap: wrap; }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .cyber-page::before,
  .float-shape,
  .cyber-card.dance,
  .s1,
  .s2 {
    animation: none !important;
  }
  .cyber-card { transition: none !important; }
}
</style>
</head>
<body>
<!-- PARTE 1 - FIN -->
<!-- Ahora pide la PARTE 2 y te la doy (TAB GAMING completo) -->
<!-- ========================= -->
<!--     TAB NAVEGACI√ìN       -->
<!-- ========================= -->

<div class="tab-container">
    <div class="tab-nav">
        <button class="tab-button active" data-tab="gaming">
            <i class="fa-solid fa-gamepad"></i> Gaming Analytics
        </button>
        <button class="tab-button" data-tab="cyber">
            <i class="fa-solid fa-shield-halved"></i> Ciberseguridad
        </button>
    </div>
</div>

<!-- ===================================================== -->
<!--                     TAB GAMING                        -->
<!-- ===================================================== -->

<div class="tab-content active" id="gaming">
    <div class="gaming-dashboard">

        <!-- ========================= -->
        <!-- HEADER PRINCIPAL GAMING   -->
        <!-- ========================= -->

        <header class="gaming">
            <h1>üéÆ Gaming Industry Analytics 2000‚Äì2025</h1>
            <p class="subtitle">An√°lisis completo del rendimiento AAA, AA e Indie en los √∫ltimos 25 a√±os.</p>

            <div id="iaModeIndicator" class="ia-mode-indicator">IA ACTIVE</div>
        </header>

        <!-- ========================= -->
        <!-- CONTROLES SUPERIORES      -->
        <!-- ========================= -->

        <div class="controls-panel">
            <div class="filter-group">
                <label for="yearRange">A√±o</label>
                <input type="range" id="yearRange" min="2000" max="2025" value="2025">
            </div>

            <div class="filter-group">
                <label for="searchBox">Buscar</label>
                <input type="text" id="searchBox" class="search-box" placeholder="Buscar juegos, problemas o datos‚Ä¶">
            </div>

            <button id="exportBtn" class="btn-secondary">
                <i class="fa-solid fa-file-export"></i> Exportar CSV
            </button>

            <button id="iaModeBtn" class="btn">
                ü§ñ Activar Simulaci√≥n IA
            </button>
        </div>

        <!-- ========================= -->
        <!-- M√âTRICAS RESUMEN          -->
        <!-- ========================= -->

        <div class="metrics-grid">
            <div class="metric-card aaa">
                <div class="metric-value" id="aaaScore">‚Äì</div>
                <div class="metric-label">AAA Score</div>
                <div class="metric-change" id="aaaTrend">‚Äì</div>
            </div>

            <div class="metric-card aa">
                <div class="metric-value" id="aaScore">‚Äì</div>
                <div class="metric-label">AA Score</div>
                <div class="metric-change" id="aaTrend">‚Äì</div>
            </div>

            <div class="metric-card indie">
                <div class="metric-value" id="indieScore">‚Äì</div>
                <div class="metric-label">Indie Score</div>
                <div class="metric-change" id="indieTrend">‚Äì</div>
            </div>
        </div>

        <!-- ========================= -->
        <!-- GR√ÅFICOS PRINCIPALES      -->
        <!-- ========================= -->

        <div class="dashboard-grid">

            <!-- GR√ÅFICO 1 -->
            <div class="chart-card full-width">
                <h3>Evoluci√≥n del rendimiento 2000‚Äì2025</h3>
                <div class="chart-container">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>

            <!-- GR√ÅFICO 2 -->
            <div class="chart-card">
                <h3>Popularidad AAA</h3>
                <div class="chart-container">
                    <canvas id="aaaChart"></canvas>
                </div>
            </div>

            <!-- GR√ÅFICO 3 -->
            <div class="chart-card">
                <h3>Popularidad AA</h3>
                <div class="chart-container">
                    <canvas id="aaChart"></canvas>
                </div>
            </div>

            <!-- GR√ÅFICO 4 -->
            <div class="chart-card">
                <h3>Popularidad Indie</h3>
                <div class="chart-container">
                    <canvas id="indieChart"></canvas>
                </div>
            </div>

            <!-- GR√ÅFICO 5 - PROYECCIONES -->
            <div class="chart-card full-width">
                <h3>Proyecciones 2025‚Äì2050</h3>
                <div class="chart-container">
                    <canvas id="futureChart"></canvas>
                </div>
            </div>

        </div>

        <!-- ========================= -->
        <!-- TABLA DE DATOS            -->
        <!-- ========================= -->

        <div class="data-table-section">

            <div class="table-controls">
                <h3>üìÑ Datos por a√±o</h3>
                <span id="tableInfo" style="color: var(--text-secondary); font-size: 0.9rem;">Mostrando todos los registros</span>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>A√±o</th>
                        <th>AAA</th>
                        <th>AA</th>
                        <th>Indie</th>
                        <th>Problema del a√±o</th>
                        <th>Ejemplos AAA</th>
                        <th>Ejemplos AA</th>
                        <th>Ejemplos Indie</th>
                    </tr>
                </thead>
                <tbody id="dataTableBody"></tbody>
            </table>
        </div>

        <!-- ========================= -->
        <!-- PANEL DE INSIGHTS         -->
        <!-- ========================= -->

        <div class="insights-panel">
            <h2>üîç Insights Clave</h2>

            <div class="insights-grid">

                <div class="insight-card">
                    <h4>üìâ Declive del AAA</h4>
                    <p id="insightAAA">‚Äì</p>
                </div>

                <div class="insight-card">
                    <h4>üìà Auge del AA</h4>
                    <p id="insightAA">‚Äì</p>
                </div>

                <div class="insight-card">
                    <h4>üöÄ Explosi√≥n Indie</h4>
                    <p id="insightIndie">‚Äì</p>
                </div>

                <div class="insight-card">
                    <h4>‚ö† Problemas recurrentes</h4>
                    <p id="insightProblems">‚Äì</p>
                </div>

            </div>
        </div>

    </div> <!-- cierre gaming-dashboard -->
</div> <!-- cierre tab-content gaming -->

<!-- FIN PARTE 2 -->
<!-- ===================================================== -->
<!--                    TAB CIBERSEGURIDAD                -->
<!-- ===================================================== -->

<div class="tab-content" id="cyber">

    <div class="cyber-page">

        <div class="float-shape s1"></div>
        <div class="float-shape s2"></div>

        <header class="cyber">
            <h1 class="cyber-title">üîê Centro Avanzado de Ciberseguridad</h1>
            <p class="cyber-subtitle">
                Informaci√≥n, visualizaciones y an√°lisis para entender amenazas modernas,
                vulnerabilidades, t√©cnicas de ataque y estrategias de defensa.
            </p>
        </header>

        <!-- ============================== -->
        <!--    SECCI√ìN PRINCIPAL: TARJETAS -->
        <!-- ============================== -->

        <h2 class="section-title">√Åreas Clave</h2>
        <p class="section-sub">Explora los pilares fundamentales de la ciberseguridad moderna.</p>

        <div class="cyber-grid" id="cyberGrid">

            <!-- CARD 1 -->
            <div class="cyber-card">
                <div class="cyber-icon"><i class="fa-solid fa-bug"></i></div>
                <h3>Amenazas Digitales</h3>
                <p>Malware, ransomware, spyware, troyanos, amenazas persistentes avanzadas.</p>
            </div>

            <!-- CARD 2 -->
            <div class="cyber-card">
                <div class="cyber-icon"><i class="fa-solid fa-shield-halved"></i></div>
                <h3>Seguridad de Red</h3>
                <p>Firewalls, IDS/IPS, segmentaci√≥n, Zero Trust, pol√≠ticas de acceso.</p>
            </div>

            <!-- CARD 3 -->
            <div class="cyber-card">
                <div class="cyber-icon"><i class="fa-solid fa-lock"></i></div>
                <h3>Cifrado</h3>
                <p>Algoritmos, criptograf√≠a moderna, protocolos TLS/SSL, claves y hash.</p>
            </div>

            <!-- CARD 4 -->
            <div class="cyber-card">
                <div class="cyber-icon"><i class="fa-solid fa-magnifying-glass"></i></div>
                <h3>An√°lisis Forense</h3>
                <p>Recuperaci√≥n de datos, trazado de ataques, evidencias digitales.</p>
            </div>

            <!-- CARD 5 -->
            <div class="cyber-card">
                <div class="cyber-icon"><i class="fa-solid fa-network-wired"></i></div>
                <h3>Pentesting</h3>
                <p>Explotaci√≥n √©tica, OSINT, pruebas de intrusi√≥n internas y externas.</p>
            </div>

            <!-- CARD 6 -->
            <div class="cyber-card">
                <div class="cyber-icon"><i class="fa-solid fa-database"></i></div>
                <h3>Protecci√≥n de Datos</h3>
                <p>Cumplimiento GDPR, anonimizaci√≥n, control de accesos, auditor√≠as.</p>
            </div>

            <!-- CARD 7 -->
            <div class="cyber-card">
                <div class="cyber-icon"><i class="fa-solid fa-user-secret"></i></div>
                <h3>Ingenier√≠a Social</h3>
                <p>Phishing, smishing, manipulaci√≥n, ataques dirigidos al factor humano.</p>
            </div>

            <!-- CARD 8 -->
            <div class="cyber-card">
                <div class="cyber-icon"><i class="fa-solid fa-brain"></i></div>
                <h3>IA en Ciberseguridad</h3>
                <p>Modelos detectores, an√°lisis de comportamiento, automatizaci√≥n forense.</p>
            </div>

        </div> <!-- cierre cyber-grid -->

        <!-- ====================================== -->
        <!--   SECCI√ìN  - TEMAS IMPORTANTES          -->
        <!-- ====================================== -->

        <h2 class="section-title">Visores Interactivos</h2>
        <p class="section-sub">Accede a material en pantalla completa (sitios remotos, documentaci√≥n, mapas, etc.)</p>

        <div class="cyber-grid">

            <div class="cyber-card cyber-open" data-open="https://www.shodan.io/">
                <div class="cyber-icon"><i class="fa-solid fa-globe"></i></div>
                <h3>Shodan</h3>
                <p>Esc√°ner de Internet para descubrir dispositivos expuestos y servicios inseguros.</p>
            </div>

            <div class="cyber-card cyber-open" data-open="https://attack.mitre.org/">
                <div class="cyber-icon"><i class="fa-solid fa-sitemap"></i></div>
                <h3>MITRE ATT&CK</h3>
                <p>Mapa de t√©cnicas de ataque en todas las fases de intrusi√≥n.</p>
            </div>

            <div class="cyber-card cyber-open" data-open="https://haveibeenpwned.com/">
                <div class="cyber-icon"><i class="fa-solid fa-file-shield"></i></div>
                <h3>HaveIBeenPwned</h3>
                <p>Comprueba si un correo ha sido filtrado en alguna brecha de datos conocida.</p>
            </div>

            <div class="cyber-card cyber-open" data-open="https://cve.mitre.org/">
                <div class="cyber-icon"><i class="fa-solid fa-explosion"></i></div>
                <h3>CVE MITRE</h3>
                <p>Base de datos oficial de vulnerabilidades y exposiciones comunes.</p>
            </div>

        </div>

        <!-- ============================= -->
        <!-- LIGHTBOX VISOR REMOTO         -->
        <!-- ============================= -->

        <div class="lightbox" id="lightbox">
            <div class="frame">
                <button class="close" id="lightboxClose"><i class="fa-solid fa-xmark"></i></button>
                <iframe id="lightboxFrame" src=""></iframe>
            </div>
        </div>

        <!-- ============================= -->
        <!-- SECCI√ìN DE REFERENCIAS        -->
        <!-- ============================= -->

        <h2 class="section-title">Recursos y Referencias</h2>
        <p class="section-sub">Documentaci√≥n y fuentes oficiales para estudio avanzado.</p>

        <div class="refs">
            <ul>
                <li><a href="https://owasp.org/">OWASP Foundation</a></li>
                <li><a href="https://www.enisa.europa.eu/">ENISA - EU Cybersecurity Agency</a></li>
                <li><a href="https://nvd.nist.gov/">NIST National Vulnerability Database</a></li>
                <li><a href="https://www.first.org/cvss/">CVSS Scoring System</a></li>
                <li><a href="https://www.iso.org/standard/75281.html">ISO/IEC 27001 Normativa</a></li>
            </ul>
        </div>

    </div> <!-- cierre cyber-page -->

</div> <!-- cierre tab-content cyber -->

<!-- FIN PARTE 3 -->
<script>
// =================== DATOS INICIALES (igual que tu fichero original) ===================
let charts = {};
let originalData = {};
let simulatedData = null;
let iaModeActive = false;

const industryData = {
  years: [2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025],
  scores: {
    aaa: [88,87,86,85,84,83,82,82,81,80,79,78,77,76,75,74,73,72,71,71,70,69,68,67,66,65],
    aa:  [35,36,38,39,41,42,44,45,47,48,50,52,54,56,58,60,62,64,76,75,74,73,72,70,69,68],
    indie:[15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90]
  },
  problems: [
    "Modelo retail, primeros DRM; industria AAA en expansi√≥n controlada",
    "Modelo retail, primeros DRM; industria AAA en expansi√≥n controlada",
    "Modelo retail, primeros DRM; industria AAA en expansi√≥n controlada",
    "Modelo retail, primeros DRM; industria AAA en expansi√≥n controlada",
    "Caso 'EA Spouse' revel√≥ abusos laborales; inicio del debate sobre el crunch.",
    "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
    "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
    "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
    "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
    "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
    "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
    "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
    "Microtransacciones emergentes, servicios en vivo, menos riesgo creativo",
    "Microtransacciones emergentes, servicios en vivo, menos riesgo creativo",
    "Microtransacciones emergentes, servicios en vivo, menos riesgo creativo",
    "Microtransacciones emergentes, servicios en vivo, menos riesgo creativo",
    "Microtransacciones emergentes, servicios en vivo, menos riesgo creativo",
    "Loot boxes, monetizaci√≥n agresiva, casos de crunch masivos",
    "Loot boxes, monetizaci√≥n agresiva, casos de crunch masivos",
    "Loot boxes, monetizaci√≥n agresiva, casos de crunch masivos",
    "Live service dominante, fusiones, p√©rdida de identidad AAA",
    "Live service dominante, fusiones, p√©rdida de identidad AAA",
    "Live service dominante, fusiones, p√©rdida de identidad AAA, despidos masivos",
    "Despidos masivos, cierres de estudios, auge de indies y AA de calidad",
    "Despidos masivos, cierres de estudios, auge de indies y AA de calidad",
    "Despidos masivos, cierres de estudios, auge de indies y AA de calidad"
  ],
  examples: {
    aaa: ["The Sims","Grand Theft Auto III","Grand Theft Auto: Vice City","Call of Duty (2003)","Half-Life 2","God of War (2005)","The Elder Scrolls IV: Oblivion","Halo 3","Fallout 3","Call of Duty: Modern Warfare 2","Red Dead Redemption","The Elder Scrolls V: Skyrim","Diablo III","Grand Theft Auto V","Destiny","The Witcher 3: Wild Hunt","Overwatch","Call of Duty: WWII","Red Dead Redemption 2","Sekiro: Shadows Die Twice","Animal Crossing: New Horizons","Call of Duty: Vanguard","Elden Ring","The Legend of Zelda: Tears of the Kingdom","Baldur's Gate 3","Spider-Man 2"],
    aa:  ["Tony Hawk's Pro Skater 2","Halo: Combat Evolved","Metroid Prime","Prince of Persia: The Sands of Time","Shadow of the Colossus","Okami","BioShock","Left 4 Dead","Demon's Souls","Alan Wake","Dark Souls","Borderlands 2","The Last of Us","Dragon Age: Inquisition","Fallout 4","Inside","Hellblade: Senua's Sacrifice","Monster Hunter: World","Control","The Last of Us Part II","Returnal","Disco Elysium: The Final Cut","Alan Wake 2","Hi-Fi Rush","Senua's Saga: Hellblade II"],
    indie:["‚Äî","‚Äî","‚Äî","‚Äî","Braid","‚Äî","‚Äî","‚Äî","Braid","Minecraft (alpha)","Limbo","Fez","FTL: Faster Than Light","Papers, Please","Shovel Knight","Undertale","Stardew Valley","Hollow Knight","Celeste","Disco Elysium","Hades","Valheim","Vampire Survivors","Sea of Stars","Dave the Diver","Hollow Knight: Silksong"]
  },
  projections: {
    years: [2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050],
    aaa: [64.4,63.32,62.41,61.50,60.59,59.68,58.77,57.86,56.96,56.05,55.14,54.23,53.32,52.41,51.50,50.59,49.68,48.77,47.86,46.96,46.05,45.14,44.23,43.32,42.41],
    aa:  [79.2,80.2,82.2,83.2,85.2,86.2,88.2,89.2,91.2,92.2,94.2,96.2,98.2,100,100,100,100,100,100,100,100,100,100,100,100],
    indie:[93,96,99,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100]
  }
};

// Guardar copia original
originalData = JSON.parse(JSON.stringify(industryData));

// =================== UTILIDADES ===================
function showNotification(message, type) {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 18px;
    border-radius: 8px;
    color: white;
    font-weight: 700;
    z-index: 9999;
    box-shadow: 0 8px 32px rgba(0,0,0,0.35);
    max-width: 320px;
  `;
  if (type === 'success') notification.style.background = 'linear-gradient(135deg,#10B981,#059669)';
  else if (type === 'error') notification.style.background = 'linear-gradient(135deg,#EF4444,#DC2626)';
  else notification.style.background = 'linear-gradient(135deg,#3B82F6,#2563EB)';
  notification.textContent = message;
  document.body.appendChild(notification);
  setTimeout(() => {
    notification.style.opacity = '0';
    notification.style.transform = 'translateY(-18px)';
    setTimeout(() => notification.remove(), 300);
  }, 3500);
}

// =================== L√ìGICA IA (corregida y robusta) ===================

async function toggleIAMode() {
  const btn = document.getElementById('iaModeBtn');
  const indicator = document.getElementById('iaModeIndicator');
  const exportBtn = document.getElementById('exportBtn');

  if (!iaModeActive) {
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generando simulaci√≥n...';
    btn.disabled = true;
    try {
      simulatedData = await callKimiAPI();
      if (simulatedData) {
        iaModeActive = true;
        indicator.style.display = 'block';
        btn.innerHTML = '‚ö† Desactivar IA';
        btn.disabled = false;
        exportBtn.disabled = true;
        updateAllCharts(simulatedData);
        populateTableWithData(simulatedData);
        generateInsightsFromData(simulatedData);
        showNotification('‚úÖ Simulaci√≥n IA activada. Datos temporales cargados.', 'success');
      } else {
        throw new Error('Datos no v√°lidos (respuesta vac√≠a o malformada)');
      }
    } catch (error) {
      console.error('Error en IA:', error);
      showNotification('‚ùå Error al generar simulaci√≥n. Intenta de nuevo.', 'error');
      btn.innerHTML = 'ü§ñ Activar Simulaci√≥n IA';
      btn.disabled = false;
    }
  } else {
    iaModeActive = false;
    simulatedData = null;
    indicator.style.display = 'none';
    btn.innerHTML = 'ü§ñ Activar Simulaci√≥n IA';
    btn.disabled = false;
    exportBtn.disabled = false;
    updateAllCharts(originalData);
    populateTableWithData(originalData);
    generateInsightsFromData(originalData);
    showNotification('üìä Modo original restaurado.', 'info');
  }
}

/**
 * callKimiAPI - Llama a Puter / kimi-k2 correctamente y devuelve JSON validado.
 * - Usa el esquema { model, messages: [...] } que requiere el SDK.
 * - Intenta extraer JSON incluso si viene envuelto en texto.
 * - Devuelve null en caso de fallo (toggleIAMode ya maneja notificaciones).
 * - Incluye timeout para evitar bloqueo indefinido.
 */
async function callKimiAPI() {
  const prompt = `
Eres un analista de videojuegos senior. Genera datos REALISTAS y COHERENTES sobre la 
industria gaming 2000-2025 siguiendo EXACTAMENTE este formato JSON:

{
"years": [2000,2001,...,2025],
"scores": {
  "aaa": [88,87,...,65],
  "aa": [35,36,...,68],
  "indie": [15,18,...,90]
},
"problems": ["texto problema a√±o 2000", "texto problema a√±o 2001", ...],
"examples": {
  "aaa": ["Juego AAA 2000", "Juego AAA 2001", ...],
  "aa": ["Juego AA 2000", "Juego AA 2001", ...],
  "indie": ["Juego Indie 2000", "Juego Indie 2001", ...]
},
"projections": {
  "years": [2026,...,2050],
  "aaa": [64.4,...,42.41],
  "aa": [79.2,...,100],
  "indie": [93,...,100]
}
}

REGLAS:
1. AAA debe mostrar DECLIVE gradual (85‚Üí65)
2. AA debe mostrar CRECIMIENTO estable (35‚Üí68)
3. Indies deben mostrar EXPLOSI√ìN (15‚Üí90)
4. Los problemas deben reflejar la evoluci√≥n real: retail ‚Üí crunch ‚Üí microtransacciones ‚Üí crisis laboral
5. Los ejemplos deben ser juegos REALISTAS por a√±o
6. Las proyecciones deben ser coherentes con tendencias
7. DEVUELVE SOLO EL JSON, sin texto adicional
8. Asegura que todos los arrays tengan EXACTAMENTE 26 elementos para datos hist√≥ricos y 25 para proyecciones
`;

  try {
    // timeout por si la API cuelga (25s)
    const response = await Promise.race([
      puter.ai.chat({
        model: 'moonshotai/kimi-k2',
        messages: [{ role: 'user', content: prompt }],
        temperature: 0.7,
        max_tokens: 4000
      }),
      new Promise((_, reject) => setTimeout(() => reject(new Error('API timeout')), 25000))
    ]);

    // extracci√≥n robusta del texto
    let raw = null;
    if (response?.choices && response.choices.length > 0) {
      raw = response.choices[0].message?.content ?? response.choices[0].text ?? null;
    }
    raw = raw ?? response?.output_text ?? response?.text ?? (typeof response === 'string' ? response : null);

    if (!raw) {
      console.error('Respuesta sin texto:', response);
      return null;
    }

    // intentar parse directo, si falla, extraer JSON del texto
    let jsonData = null;
    try {
      jsonData = JSON.parse(raw);
    } catch (e) {
      const match = raw.match(/\{[\s\S]*\}/);
      if (match) {
        try {
          jsonData = JSON.parse(match[0]);
        } catch (e2) {
          console.error('Fallo parseando JSON extra√≠do:', e2, match[0]);
          return null;
        }
      } else {
        console.error('No se encontr√≥ JSON en la respuesta raw:', raw);
        return null;
      }
    }

    // validaci√≥n m√≠nima de la estructura
    if (
      jsonData &&
      Array.isArray(jsonData.years) && jsonData.years.length === 26 &&
      jsonData.scores &&
      Array.isArray(jsonData.scores.aaa) && jsonData.scores.aaa.length === 26 &&
      Array.isArray(jsonData.scores.aa) && jsonData.scores.aa.length === 26 &&
      Array.isArray(jsonData.scores.indie) && jsonData.scores.indie.length === 26 &&
      Array.isArray(jsonData.problems) && jsonData.problems.length === 26
    ) {
      return jsonData;
    } else {
      console.error('Estructura de datos inv√°lida o incompleta devuelta por el modelo:', jsonData);
      return null;
    }
  } catch (error) {
    console.error('Error en callKimiAPI:', error);
    return null;
  }
}

// =================== CHARTS y UI ===================
function initializeCharts() {
  // Main trend chart
  const mainCtx = document.getElementById('mainChart').getContext('2d');
  charts.main = new Chart(mainCtx, {
    type: 'line',
    data: {
      labels: industryData.years,
      datasets: [
        { label: 'AAA', data: industryData.scores.aaa, borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.08)', borderWidth: 2, tension: 0.3, pointRadius: 3 },
        { label: 'AA',  data: industryData.scores.aa,  borderColor: '#F59E0B', backgroundColor: 'rgba(245,158,11,0.08)', borderWidth: 2, tension: 0.3, pointRadius: 3 },
        { label: 'Indie',data: industryData.scores.indie, borderColor: '#10B981', backgroundColor: 'rgba(16,185,129,0.08)', borderWidth: 2, tension: 0.3, pointRadius: 3 }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { labels: { color: '#F1F5F9' } },
        tooltip: {}
      },
      scales: { y: { beginAtZero: true, max: 100, ticks: { color: '#94A3B8' } }, x: { ticks: { color: '#94A3B8' } } }
    }
  });

  // small charts: AAA / AA / Indie (sparkline-like)
  const aaaCtx = document.getElementById('aaaChart').getContext('2d');
  charts.aaa = new Chart(aaaCtx, {
    type: 'line',
    data: { labels: industryData.years, datasets: [{ label: 'AAA', data: industryData.scores.aaa, borderColor: '#EF4444', fill: true, backgroundColor: 'rgba(239,68,68,0.06)', tension: 0.4 }] },
    options: { responsive: true, maintainAspectRatio: false, scales: { x: { display: false }, y: { display: false } }, plugins: { legend: { display: false } } }
  });

  const aaCtx = document.getElementById('aaChart').getContext('2d');
  charts.aa = new Chart(aaCtx, {
    type: 'line',
    data: { labels: industryData.years, datasets: [{ label: 'AA', data: industryData.scores.aa, borderColor: '#F59E0B', fill: true, backgroundColor: 'rgba(245,158,11,0.06)', tension: 0.4 }] },
    options: { responsive: true, maintainAspectRatio: false, scales: { x: { display: false }, y: { display: false } }, plugins: { legend: { display: false } } }
  });

  const indieCtx = document.getElementById('indieChart').getContext('2d');
  charts.indie = new Chart(indieCtx, {
    type: 'line',
    data: { labels: industryData.years, datasets: [{ label: 'Indie', data: industryData.scores.indie, borderColor: '#10B981', fill: true, backgroundColor: 'rgba(16,185,129,0.06)', tension: 0.4 }] },
    options: { responsive: true, maintainAspectRatio: false, scales: { x: { display: false }, y: { display: false } }, plugins: { legend: { display: false } } }
  });

  // Future chart (historic + projections)
  const futureCtx = document.getElementById('futureChart').getContext('2d');
  const combinedLabels = [...industryData.years, ...industryData.projections.years];
  charts.future = new Chart(futureCtx, {
    type: 'line',
    data: {
      labels: combinedLabels,
      datasets: [
        { label: 'AAA (Hist√≥rico)', data: [...industryData.scores.aaa, ...Array(industryData.projections.years.length).fill(null)], borderColor: '#EF4444', borderWidth: 2 },
        { label: 'AAA (Proyecci√≥n)', data: [...Array(industryData.years.length).fill(null), ...industryData.projections.aaa], borderColor: '#EF4444', borderWidth: 2, borderDash: [6,4], pointRadius: 0 },
        { label: 'AA (Hist√≥rico)', data: [...industryData.scores.aa, ...Array(industryData.projections.years.length).fill(null)], borderColor: '#F59E0B', borderWidth: 2 },
        { label: 'AA (Proyecci√≥n)', data: [...Array(industryData.years.length).fill(null), ...industryData.projections.aa], borderColor: '#F59E0B', borderWidth: 2, borderDash: [6,4], pointRadius: 0 },
        { label: 'Indie (Hist√≥rico)', data: [...industryData.scores.indie, ...Array(industryData.projections.years.length).fill(null)], borderColor: '#10B981', borderWidth: 2 },
        { label: 'Indie (Proyecci√≥n)', data: [...Array(industryData.years.length).fill(null), ...industryData.projections.indie], borderColor: '#10B981', borderWidth: 2, borderDash: [6,4], pointRadius: 0 }
      ]
    },
    options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 100, ticks: { color: '#94A3B8' } }, x: { ticks: { color: '#94A3B8' } } }, plugins: { legend: { labels: { color: '#F1F5F9' } } } }
  });
}

// Actualiza todos los charts con una nueva estructura de datos
function updateAllCharts(data) {
  // actualizar n√∫meros de resumen
  document.getElementById('aaaScore').textContent = data.scores.aaa[data.scores.aaa.length - 1];
  document.getElementById('aaScore').textContent = data.scores.aa[data.scores.aa.length - 1];
  document.getElementById('indieScore').textContent = data.scores.indie[data.scores.indie.length - 1];

  // main
  charts.main.data.labels = data.years;
  charts.main.data.datasets[0].data = data.scores.aaa;
  charts.main.data.datasets[1].data = data.scores.aa;
  charts.main.data.datasets[2].data = data.scores.indie;
  charts.main.update();

  // small charts
  charts.aaa.data.labels = data.years;
  charts.aaa.data.datasets[0].data = data.scores.aaa;
  charts.aaa.update();

  charts.aa.data.labels = data.years;
  charts.aa.data.datasets[0].data = data.scores.aa;
  charts.aa.update();

  charts.indie.data.labels = data.years;
  charts.indie.data.datasets[0].data = data.scores.indie;
  charts.indie.update();

  // futuro
  const combinedLabels = [...data.years, ...(data.projections?.years || [])];
  charts.future.data.labels = combinedLabels;
  charts.future.data.datasets[0].data = [...data.scores.aaa, ...Array((data.projections?.years || []).length).fill(null)];
  charts.future.data.datasets[1].data = [...Array(data.years.length).fill(null), ...(data.projections?.aaa || [])];
  charts.future.data.datasets[2].data = [...data.scores.aa, ...Array((data.projections?.years || []).length).fill(null)];
  charts.future.data.datasets[3].data = [...Array(data.years.length).fill(null), ...(data.projections?.aa || [])];
  charts.future.data.datasets[4].data = [...data.scores.indie, ...Array((data.projections?.years || []).length).fill(null)];
  charts.future.data.datasets[5].data = [...Array(data.years.length).fill(null), ...(data.projections?.indie || [])];
  charts.future.update();
}

// =================== TABLA ===================
function populateTableWithData(data) {
  const tbody = document.getElementById('dataTableBody');
  tbody.innerHTML = '';
  data.years.forEach((year, i) => {
    const tr = document.createElement('tr');
    const trendAAA = i > 0 ? data.scores.aaa[i] - data.scores.aaa[i-1] : 0;
    const trendAA  = i > 0 ? data.scores.aa[i] - data.scores.aa[i-1] : 0;
    const trendInd = i > 0 ? data.scores.indie[i] - data.scores.indie[i-1] : 0;
    tr.innerHTML = `
      <td><strong>${year}</strong></td>
      <td>${data.scores.aaa[i]} <span class="${trendAAA>=0?'trend-up':'trend-down'}" style="margin-left:8px;"></span></td>
      <td>${data.scores.aa[i]} <span class="${trendAA>=0?'trend-up':'trend-down'}" style="margin-left:8px;"></span></td>
      <td>${data.scores.indie[i]} <span class="${trendInd>=0?'trend-up':'trend-down'}" style="margin-left:8px;"></span></td>
      <td>${data.problems[i] || '‚Äî'}</td>
      <td>${(data.examples?.aaa?.[i]) || '‚Äî'}</td>
      <td>${(data.examples?.aa?.[i]) || '‚Äî'}</td>
      <td>${(data.examples?.indie?.[i]) || '‚Äî'}</td>
    `;
    tbody.appendChild(tr);
  });
}

// =================== INSIGHTS ===================
function generateInsightsFromData(data) {
  // c√°lculo simple y directo para las tarjetas
  const aaaDecline = ((data.scores.aaa[0] - data.scores.aaa[data.scores.aaa.length-1]) / data.scores.aaa[0] * 100).toFixed(1);
  const indieGrowth = ((data.scores.indie[data.scores.indie.length-1] - data.scores.indie[0]) / data.scores.indie[0] * 100).toFixed(0);
  const aaDiff = data.scores.aa[data.scores.aa.length-1] - data.scores.aa[0];

  document.getElementById('insightAAA').textContent = `Las AAA han perdido ${aaaDecline}% en nota media desde 2000.`;
  document.getElementById('insightAA').textContent = `AA ha ganado ${aaDiff} puntos en 25 a√±os y recupera relevancia.`;
  document.getElementById('insightIndie').textContent = `Indies +${indieGrowth}%: han pasado de proyectos peque√±os a liderar creatividad.`;
  const recentProblems = data.problems.slice(-5).join(' ¬∑ ');
  document.getElementById('insightProblems').textContent = `√öltimos problemas detectados: ${recentProblems}`;
}

// =================== FILTRADO Y B√öSQUEDA ===================

function applySearchAndFilters() {
  const q = (document.getElementById('searchBox').value || '').toLowerCase().trim();
  const tbody = document.getElementById('dataTableBody');
  Array.from(tbody.querySelectorAll('tr')).forEach(row => {
    if (!q) {
      row.style.display = '';
      return;
    }
    const text = row.textContent.toLowerCase();
    row.style.display = text.includes(q) ? '' : 'none';
  });
}

// =================== EXPORT CSV ===================
function exportCSV() {
  const data = iaModeActive && simulatedData ? simulatedData : originalData;
  const rows = [['A√±o','AAA','AA','Indie','Problema','Ejemplo AAA','Ejemplo AA','Ejemplo Indie']];
  data.years.forEach((y, i) => {
    rows.push([
      y,
      data.scores.aaa[i],
      data.scores.aa[i],
      data.scores.indie[i],
      `"${(data.problems[i]||'').replace(/"/g,'""')}"`,
      `"${(data.examples?.aaa?.[i]||'').replace(/"/g,'""')}"`,
      `"${(data.examples?.aa?.[i]||'').replace(/"/g,'""')}"`,
      `"${(data.examples?.indie?.[i]||'').replace(/"/g,'""')}"`
    ]);
  });
  const csv = rows.map(r => r.join(',')).join('\n');
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'gaming_data.csv';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
  showNotification('üì• CSV descargado.', 'success');
}

// =================== LIGHTBOX / VISOR REMOTO ===================
function initLightbox() {
  document.querySelectorAll('.cyber-open').forEach(btn => {
    btn.addEventListener('click', () => {
      const url = btn.dataset.open;
      if (!url) return;
      const lb = document.getElementById('lightbox');
      const frame = document.getElementById('lightboxFrame');
      frame.src = url;
      lb.classList.add('active');
    });
  });

  document.getElementById('lightboxClose').addEventListener('click', () => {
    const lb = document.getElementById('lightbox');
    const frame = document.getElementById('lightboxFrame');
    frame.src = '';
    lb.classList.remove('active');
  });
}

// =================== PESTA√ëAS ===================
function setupTabs() {
  document.querySelectorAll('.tab-button').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const tab = btn.dataset.tab || (btn.getAttribute('data-tab') || '');
      // botones
      document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      // content
      document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
      if (tab === 'cyber') document.getElementById('cyber').classList.add('active');
      else document.getElementById('gaming').classList.add('active');
    });
  });
}

// =================== EVENT LISTENERS INICIALES ===================
function setupEventListeners() {
  // filtros y busqueda
  document.getElementById('searchBox').addEventListener('input', () => applySearchAndFilters());
  document.getElementById('exportBtn').addEventListener('click', () => exportCSV());
  document.getElementById('iaModeBtn').addEventListener('click', () => toggleIAMode());
  // range (si quieres comportamiento extra, lo puedes adaptar)
  const yearRange = document.getElementById('yearRange');
  if (yearRange) {
    yearRange.addEventListener('input', (e) => {
      const v = parseInt(e.target.value, 10);
      // select glasses: hacemos zoom en los gr√°ficos mostrando hasta el a√±o seleccionado
      const idx = industryData.years.indexOf(v);
      if (idx >= 0) {
        const sliced = {
          years: industryData.years.slice(0, idx+1),
          scores: {
            aaa: industryData.scores.aaa.slice(0, idx+1),
            aa: industryData.scores.aa.slice(0, idx+1),
            indie: industryData.scores.indie.slice(0, idx+1)
          },
          problems: industryData.problems.slice(0, idx+1),
          examples: {
            aaa: industryData.examples.aaa.slice(0, idx+1),
            aa: industryData.examples.aa.slice(0, idx+1),
            indie: industryData.examples.indie.slice(0, idx+1)
          },
          projections: industryData.projections
        };
        updateAllCharts(sliced);
        populateTableWithData(sliced);
      }
    });
  }
}

// =================== INIT ===================
document.addEventListener('DOMContentLoaded', () => {
  // inits
  initializeCharts();
  populateTableWithData(industryData);
  generateInsightsFromData(industryData);
  setupEventListeners();
  setupTabs();
  initLightbox();
});

// =================== FIN ===================
</script>
