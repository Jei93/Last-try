<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gaming Analytics & Cybersecurity | Dashboard IA</title>

  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <script src="https://js.puter.com/v2/"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    /* Estilos base (dark theme) */
    :root {
      --bg-primary: #0F172A;
      --bg-secondary: #1E293B;
      --bg-card: #1E293B;
      --text-primary: #F1F5F9;
      --text-secondary: #94A3B8;
      --accent-aaa: #EF4444;
      --accent-aa: #F59E0B;
      --accent-indie: #10B981;
      --border: #334155;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --card-radius: 16px;
      --muted: #9fdcff;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    /* Sistema de pesta√±as */
    .tab-container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
    }
    .tab-nav {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      background: var(--bg-card);
      padding: 10px;
      border-radius: 12px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .tab-button {
      background: var(--bg-primary);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .tab-button.active {
      background: #3B82F6;
      color: white;
      border-color: #3B82F6;
    }
    .tab-button:hover:not(.active) {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Gaming dashboard */
    .gaming-dashboard { max-width: 1600px; margin: 0 auto; }
    header.gaming {
      background: linear-gradient(135deg, var(--bg-secondary), #2563EB);
      padding: 30px;
      border-radius: 16px;
      margin-bottom: 30px;
      box-shadow: var(--shadow);
      position: relative;
    }
    header.gaming h1 {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 10px;
      background: linear-gradient(to right, #FFF, #93C5FD);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .subtitle { color: var(--text-secondary); font-size: 1.1rem; }

    .controls-panel {
      background: var(--bg-card);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      align-items: center;
      border: 1px solid var(--border);
    }
    .filter-group { display: flex; flex-direction: column; gap: 8px; }
    label { font-size: 0.875rem; color: var(--text-secondary); font-weight: 500; }
    select, input[type="range"], .search-box {
      background: var(--bg-primary);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 0.9rem;
    }
    .btn {
      background: #3B82F6; color: white; border: none; padding: 10px 20px;
      border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s;
    }
    .btn:hover { background: #2563EB; transform: translateY(-1px); }
    .btn-secondary { background: var(--bg-primary); border: 1px solid var(--border); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }
    .chart-card {
      background: var(--bg-card); padding: 25px; border-radius: 12px;
      border: 1px solid var(--border); box-shadow: var(--shadow); position: relative;
    }
    .chart-card h3 { font-size: 1.25rem; margin-bottom: 20px; color: var(--text-primary); font-weight: 600; }
    .chart-container { position: relative; height: 300px; }
    .full-width { grid-column: 1 / -1; }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px; margin-bottom: 30px;
    }
    .metric-card {
      background: var(--bg-card); padding: 25px; border-radius: 12px;
      border-left: 4px solid var(--accent-indie); box-shadow: var(--shadow);
    }
    .metric-card.aaa { border-left-color: var(--accent-aaa); }
    .metric-card.aa  { border-left-color: var(--accent-aa); }
    .metric-value { font-size: 2.5rem; font-weight: 800; margin-bottom: 5px; }
    .metric-label { color: var(--text-secondary); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; }
    .metric-change { font-size: 0.875rem; margin-top: 8px; padding: 4px 8px; border-radius: 4px; display: inline-block; }
    .positive { background: rgba(16, 185, 129, 0.1); color: #10B981; }
    .negative { background: rgba(239, 68, 68, 0.1); color: #EF4444; }
    .trend-indicator {
      display: inline-block; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; margin-left: 8px;
    }
    .trend-up { border-bottom: 10px solid #10B981; }
    .trend-down { border-top: 10px solid #EF4444; }

    .data-table-section {
      background: var(--bg-card); padding: 25px; border-radius: 12px;
      border: 1px solid var(--border); box-shadow: var(--shadow); margin-top: 30px;
    }
    .table-controls {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;
      flex-wrap: wrap; gap: 15px;
    }
    table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); }
    th {
      background: var(--bg-primary); font-weight: 600; color: var(--text-secondary);
      position: sticky; top: 0;
    }
    tr:hover { background: rgba(255, 255, 255, 0.02); }

    .insights-panel {
      background: linear-gradient(135deg, #1E3A8A, #3B82F6);
      padding: 25px; border-radius: 12px; margin-top: 30px; color: white;
    }
    .insights-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
    .insight-card { background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 8px; backdrop-filter: blur(10px); }
    .insight-card h4 { margin-bottom: 10px; font-size: 1.1rem; }

    .ia-mode-indicator {
      position: absolute; top: 20px; right: 20px;
      background: linear-gradient(45deg, #EF4444, #F59E0B);
      padding: 8px 16px; border-radius: 20px; font-size: 0.875rem; font-weight: 700; color: white; display: none; animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.7} }

    /* Ciberseguridad */
    .cyber-page {
      min-height: 100vh; padding: 48px 20px 88px;
      background: linear-gradient(120deg, rgba(10,30,60,0.98), rgba(2,10,30,0.98));
      position: relative; overflow: hidden; perspective: 1600px;
    }
    .cyber-page::before {
      content: "";
      position: fixed; inset: -25% -25% -25% -25%; z-index: -2;
      background: conic-gradient(from 0deg at 50% 50%, #ff004d, #ff8a00, #ffee00, #00ff9d, #00b2ff, #9a00ff, #ff004d);
      background-size: 220% 220%; filter: blur(44px) saturate(200%); opacity: 0.18; transform: scale(1.02); animation: spinbg 20s linear infinite; mix-blend-mode: screen;
    }
    @keyframes spinbg { 0%{transform:rotate(0)} 50%{transform:rotate(180deg) scale(1.02)} 100%{transform:rotate(360deg)} }

    .float-shape { position: absolute; width: 220px; height: 220px; border-radius: 32px; filter: blur(40px); opacity: 0.08; z-index: -1; }
    .s1 { right: 6%; top: 4%; background: linear-gradient(45deg, #00f0ff66, #7b61ff66); animation: floaty 10s ease-in-out infinite; }
    .s2 { left: 4%; bottom: 6%; background: linear-gradient(45deg, #ff6a8866, #ffd27a66); animation: floaty 14s ease-in-out infinite reverse; }
    @keyframes floaty { 0%{transform:translateY(0) rotate(0)} 50%{transform:translateY(-30px) rotate(8deg)} 100%{transform:translateY(0) rotate(0)} }

    header.cyber { max-width: 1100px; margin: 0 auto 18px; padding: 6px 18px; }
    .cyber-title {
      font-size: 3.4rem; margin: 0; line-height: 1; font-weight: 900; letter-spacing: -0.02em;
      background: linear-gradient(90deg, #00f5ff, #7b61ff, #ff6a88, #ffd27a, #7effb2, #00f5ff);
      background-size: 420% 100%; -webkit-background-clip: text; background-clip: text; color: transparent;
      animation: hueShift 4.6s linear infinite, titleBeams 3.6s ease-in-out infinite;
      text-shadow: 0 12px 56px rgba(123,97,255,0.22), 0 36px 160px rgba(255,106,136,0.08), 0 0 260px rgba(0,245,255,0.09);
      filter: saturate(1.55) contrast(1.05);
    }
    @keyframes hueShift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    @keyframes titleBeams { 0%{filter:brightness(1) saturate(1.4)} 30%{filter:brightness(1.35) saturate(1.6) drop-shadow(0 8px 36px rgba(255,255,255,0.06))} 60%{filter:brightness(1.6) saturate(1.8) drop-shadow(0 18px 90px rgba(255,255,255,0.09))} 100%{filter:brightness(1) saturate(1.4)} }

    .cyber-subtitle { margin-top: 12px; color: var(--muted); font-size: 1rem; max-width: 980px; }
    .cyber-grid { max-width: 1100px; margin: 28px auto 0; display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 18px; }
    .cyber-card {
      padding: 18px; border-radius: calc(var(--card-radius) + 4px);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
      border: 1px solid rgba(255,255,255,0.035); box-shadow: 0 14px 36px rgba(2,10,20,0.52);
      color: #fff; display: flex; flex-direction: column; gap: 10px; min-height: 120px;
      transition: transform 0.28s cubic-bezier(0.2, 0.9, 0.2, 1), box-shadow 0.28s, filter 0.28s;
      transform-origin: center center; opacity: 0; transform: translateY(14px) scale(0.99);
      position: relative; cursor: default; overflow: visible; will-change: transform; transform-style: preserve-3d;
    }
    .cyber-card.visible { opacity: 1; transform: translateY(0) scale(1); animation: popIn 0.6s cubic-bezier(0.2, 0.9, 0.2, 1); }
    @keyframes popIn { 0%{opacity:0; transform:translateY(10px) scale(.992) rotateX(6deg)} 60%{transform:translateY(-6px) scale(1.02) rotateX(0)} 100%{opacity:1; transform:translateY(0) scale(1)} }
    .cyber-card.dance { animation: danceXy 4.8s ease-in-out infinite; }
    @keyframes danceXy { 0%{transform:translateX(calc(var(--dance-range, 8px) * -1)) translateY(0) rotate(-0.6deg)} 50%{transform:translateX(calc(var(--dance-range, 8px))) translateY(2px) rotate(0.8deg)} 100%{transform:translateX(calc(var(--dance-range, 8px) * -1)) translateY(0) rotate(-0.6deg)} }
    .cyber-card:hover {
      transform: translateY(-18px) scale(1.06) rotateZ(-0.8deg);
      box-shadow: 0 46px 100px rgba(0,0,0,0.68), 0 0 38px rgba(255,106,136,0.06) inset;
      filter: brightness(1.04) saturate(1.08); z-index: 6;
    }
    .cyber-card::after {
      content: ""; position: absolute; left: -12%; top: -20px; width: 124%; height: 200%;
      pointer-events: none;
      background: radial-gradient(500px 120px at 20% 10%, rgba(255,255,255,0.04), transparent 12%), linear-gradient(90deg, rgba(255,255,255,0.02), transparent 40%);
      transform: translateY(6px) rotate(2deg); opacity: 0; transition: opacity 0.32s, transform 0.5s; border-radius: inherit; mix-blend-mode: screen;
    }
    .cyber-card:hover::after { opacity: 1; transform: translateY(-6px) rotate(-0.5deg); }
    .cyber-icon {
      font-size: 28px; color: transparent; width: 54px; height: 54px; display: inline-flex; align-items: center; justify-content: center;
      border-radius: 12px; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.03); position: relative; z-index: 2;
    }
    .cyber-icon i { color: #00f0ff; transition: transform 0.32s cubic-bezier(0.2,0.9,0.2,1), color 0.28s, text-shadow 0.28s; font-size: 20px; }
    .cyber-card:hover .cyber-icon i { transform: translateY(-8px) scale(1.12) rotate(-8deg); color: #ff3d9a; text-shadow: 0 8px 24px rgba(255,106,136,0.14); }
    .cyber-card h3 {
      margin: 0; font-size: 1.05rem; font-weight: 900; letter-spacing: 0.005em; position: relative; z-index: 2;
      background: linear-gradient(90deg, #ffd27a, #ff6a88, #7b61ff);
      -webkit-background-clip: text; background-clip: text; color: transparent; filter: saturate(1.25); text-shadow: 0 6px 24px rgba(255,106,136,0.06);
    }
    .cyber-card p { margin: 0; color: #dff7fb; line-height: 1.45; font-size: 0.95rem; position: relative; z-index: 2; }

    .section-title {
      font-size: 1.6rem; margin: 36px auto 8px; max-width: 1100px; text-transform: uppercase; letter-spacing: 0.08em; font-weight: 900;
      background: linear-gradient(90deg, #00f5ff, #7b61ff, #ff6a88, #ffd27a, #7effb2);
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 10px 48px rgba(123,97,255,0.16), 0 30px 140px rgba(255,106,136,0.07); text-align: center; filter: saturate(1.45);
    }
    .section-sub { max-width: 1100px; margin: 0 auto 18px; color: rgba(200,240,255,0.95); text-align: center; }

    .lightbox {
      position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(2,6,12,0.82); z-index: 1600; padding: 24px;
    }
    .lightbox.active { display: flex; }
    .lightbox .frame {
      margin: auto; width: min(1100px, 92%); height: min(720px, 86%);
      background: linear-gradient(180deg, #000, #060606);
      border-radius: 16px; overflow: hidden; position: relative;
      box-shadow: 0 40px 140px rgba(0,0,0,0.85), 0 0 80px rgba(123,97,255,0.06);
      transform-origin: center center; display: flex; align-items: center; justify-content: center;
      animation: lbPop 0.28s cubic-bezier(0.2, 0.9, 0.2, 1);
    }
    @keyframes lbPop { from{transform:scale(.98); opacity:.7} to{transform:scale(1); opacity:1} }
    .lightbox iframe { width: 100%; height: 100%; border: 0; display: block; background: #000; }
    .lightbox .close {
      position: absolute; right: 14px; top: 14px; background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      color: #fff; border-radius: 10px; padding: 10px 12px; border: 0; cursor: pointer; z-index: 5; backdrop-filter: blur(6px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    }

    .refs {
      max-width: 1100px; margin: 28px auto 0; padding: 18px; border-radius: 12px;
      background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.03); color: var(--muted);
    }
    .refs a { color: #00f0ff; text-decoration: underline; }

    @media (max-width: 768px) {
      .dashboard-grid { grid-template-columns: 1fr; }
      .controls-panel { flex-direction: column; align-items: stretch; }
      .title { font-size: 1.9rem; }
      .cyber-title { font-size: 2.5rem; }
      .tab-nav { flex-wrap: wrap; }
    }

    @media (prefers-reduced-motion: reduce) {
      .cyber-page::before,
      .float-shape,
      .cyber-card.dance,
      .s1,
      .s2 { animation: none !important; }
      .cyber-card { transition: none !important; }
    }
  </style>
</head>
<body>
  <div class="tab-container">
    <nav class="tab-nav">
      <button class="tab-button active" onclick="switchTab('gaming')">
        <i class="fas fa-gamepad"></i> Gaming Analytics
      </button>
      <button class="tab-button" onclick="switchTab('cybersecurity')">
        <i class="fas fa-shield-alt"></i> Ciberseguridad
      </button>
    </nav>

    <!-- Pesta√±a Gaming -->
    <div id="gaming-tab" class="tab-content active">
      <div class="gaming-dashboard">
        <header class="gaming">
          <div class="ia-mode-indicator" id="iaModeIndicator">MODO SIMULACI√ìN IA</div>
          <h1>Industria Gaming: An√°lisis 2000-2025 | Dashboard Profesional</h1>
          <p class="subtitle">Tendencias, problem√°ticas y evoluci√≥n del mercado (2000-2025)</p>
        </header>

        <div class="controls-panel">
          <div class="filter-group">
            <label>Rango de A√±os</label>
            <select id="yearRange">
              <option value="all">2000-2025</option>
              <option value="2000-2010">Era Retail (2000-2010)</option>
              <option value="2010-2020">Era Digital (2010-2020)</option>
              <option value="2020-2025">Era Moderna (2020-2025)</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Tipo de Juego</label>
            <select id="gameType">
              <option value="all">Todos</option>
              <option value="aaa">AAA</option>
              <option value="aa">AA</option>
              <option value="indie">Indie</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Enfoque An√°lisis</label>
            <select id="analysisFocus">
              <option value="scores">Notas Medias</option>
              <option value="growth">Crecimiento Relativo</option>
              <option value="problems">Problem√°ticas</option>
            </select>
          </div>
          <button class="btn" onclick="toggleIAMode()" id="iaModeBtn">ü§ñ Activar Simulaci√≥n IA</button>
          <button class="btn btn-secondary" onclick="resetFilters()">Reset</button>
          <button class="btn" onclick="exportData()" id="exportBtn">Exportar Datos</button>
        </div>

        <div class="metrics-grid">
          <div class="metric-card aaa">
            <div class="metric-value" id="aaaCurrent">65</div>
            <div class="metric-label">Nota Media AAA 2025</div>
            <div class="metric-change negative">-26.1% desde 2000 <span class="trend-indicator trend-down"></span></div>
          </div>
          <div class="metric-card aa">
            <div class="metric-value" id="aaCurrent">68</div>
            <div class="metric-label">Nota Media AA 2025</div>
            <div class="metric-change positive">+94.3% desde 2000 <span class="trend-indicator trend-up"></span></div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="indieCurrent">90</div>
            <div class="metric-label">Nota Media Indie 2025</div>
            <div class="metric-change positive">+500% desde 2000 <span class="trend-indicator trend-up"></span></div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="convergence">2022</div>
            <div class="metric-label">Punto de Inflexi√≥n</div>
            <div class="metric-change positive">Indies superan a AAA <span class="trend-indicator trend-up"></span></div>
          </div>
        </div>

        <div class="dashboard-grid">
          <div class="chart-card">
            <h3>Evoluci√≥n de Notas Medias</h3>
            <div class="chart-container"><canvas id="trendChart"></canvas></div>
          </div>
          <div class="chart-card">
            <h3>Comparativa Segmentos</h3>
            <div class="chart-container"><canvas id="comparisonChart"></canvas></div>
          </div>
          <div class="chart-card">
            <h3>Mapa de Problemas de Industria</h3>
            <div class="chart-container"><canvas id="heatmapChart"></canvas></div>
          </div>
          <div class="chart-card">
            <h3>Crecimiento Relativo (%)</h3>
            <div class="chart-container"><canvas id="growthChart"></canvas></div>
          </div>
          <div class="chart-card full-width">
            <h3>An√°lisis de Proyecciones</h3>
            <div class="chart-container"><canvas id="projectionChart"></canvas></div>
          </div>
        </div>

        <div class="insights-panel">
          <h2>Insights Autom√°ticos del Dataset</h2>
          <div class="insights-grid" id="insightsGrid"></div>
        </div>

        <div class="data-table-section">
          <div class="table-controls">
            <h3>Base de Datos Completa</h3>
            <input type="text" class="search-box" id="searchTable" placeholder="Buscar por a√±o, juego o problema..." />
          </div>
          <div style="overflow-x: auto;">
            <table id="dataTable">
              <thead>
                <tr>
                  <th>A√±o</th>
                  <th>Nota AAA</th>
                  <th>Nota AA</th>
                  <th>Nota Indie</th>
                  <th>Problemas Clave</th>
                  <th>Juego AAA Ejemplo</th>
                  <th>Juego AA Ejemplo</th>
                  <th>Juego Indie Ejemplo</th>
                  <th>Tendencia</th>
                </tr>
              </thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Pesta√±a Ciberseguridad -->
    <div id="cybersecurity-tab" class="tab-content">
      <div class="cyber-page">
        <div class="float-shape s1" aria-hidden="true"></div>
        <div class="float-shape s2" aria-hidden="true"></div>
        <header class="cyber">
          <h1 class="cyber-title">Ciberseguridad</h1>
          <p class="cyber-subtitle">Definici√≥n, principales amenazas y dec√°logo de buenas pr√°cticas.</p>
        </header>

        <section aria-label="Principales amenazas" class="content">
          <h2 class="section-title">PRINCIPALES AMENAZAS</h2>
          <p class="section-sub">Resumen de los riesgos que conviene conocer para proteger informaci√≥n personal y dispositivos.</p>

          <div class="cyber-grid" id="threats">
            <article class="cyber-card" role="article">
              <div class="cyber-icon"><i class="fa-regular fa-envelope-open"></i></div>
              <h3>PHISHING</h3>
              <p>Mensajes falsos (correo, SMS, apps) que buscan enga√±ar para robar credenciales o datos bancarios.</p>
            </article>

            <article class="cyber-card" role="article">
              <div class="cyber-icon"><i class="fa-solid fa-bug"></i></div>
              <h3>MALWARE</h3>
              <p>Software malicioso: virus, troyanos y spyware que da√±an o esp√≠an dispositivos y datos.</p>
            </article>

            <article class="cyber-card" role="article">
              <div class="cyber-icon"><i class="fa-solid fa-lock"></i></div>
              <h3>RANSOMWARE</h3>
              <p>Malware que cifra datos y exige rescate; mantener backups reduce impacto.</p>
            </article>

            <article class="cyber-card" role="article">
              <div class="cyber-icon"><i class="fa-solid fa-server"></i></div>
              <h3>DDoS</h3>
              <p>Ataques que saturan servidores con tr√°fico falso para interrumpir servicios.</p>
            </article>

            <article class="cyber-card" role="article">
              <div class="cyber-icon"><i class="fa-solid fa-key"></i></div>
              <h3>FUERZA BRUTA</h3>
              <p>Intentos automatizados para adivinar contrase√±as d√©biles mediante muchas combinaciones.</p>
            </article>

            <article class="cyber-card" role="article">
              <div class="cyber-icon"><i class="fa-solid fa-user-secret"></i></div>
              <h3>INGENIER√çA SOCIAL</h3>
              <p>Manipulaci√≥n psicol√≥gica (llamadas, mensajes, pretextos) para obtener acceso o informaci√≥n.</p>
            </article>

            <article class="cyber-card" role="article">
              <div class="cyber-icon"><i class="fa-solid fa-truck-fast"></i></div>
              <h3>SUPPLY CHAIN</h3>
              <p>Comprometer proveedores o software de terceros para infiltrar plataformas leg√≠timas.</p>
            </article>

            <article class="cyber-card" role="article">
              <div class="cyber-icon"><i class="fa-solid fa-cloud"></i></div>
              <h3>NUBE</h3>
              <p>Errores de configuraci√≥n en servicios cloud que permiten fugas de datos o accesos no autorizados.</p>
            </article>

            <article class="cyber-card" role="article">
              <div class="cyber-icon"><i class="fa-solid fa-wifi"></i></div>
              <h3>IoT</h3>
              <p>Dispositivos conectados sin protecciones que se convierten en puerta de entrada para atacantes.</p>
            </article>

            <article class="cyber-card" role="article">
              <div class="cyber-icon"><i class="fa-solid fa-database"></i></div>
              <h3>DATA LEAK</h3>
              <p>Exposici√≥n o robo de informaci√≥n sensible que puede derivar en fraude o suplantaci√≥n.</p>
            </article>
          </div>
        </section>

        <div class="header-decal" style="max-width:1100px;margin:32px auto 0;padding:6px 18px;">
          <h2 class="section-title">DEC√ÅLOGO - Buenas pr√°cticas</h2>
          <p class="section-sub">Diez acciones sencillas y efectivas para proteger cuentas, dispositivos y datos.</p>
        </div>

        <section class="cyber-grid" aria-label="Dec√°logo" id="rules">
          <article class="cyber-card"><div class="cyber-icon"><i class="fa-solid fa-lock"></i></div><h3>CONTRASE√ëAS</h3><p>Usa contrase√±as largas y √∫nicas; utiliza frases y un gestor cuando sea posible.</p></article>
          <article class="cyber-card"><div class="cyber-icon"><i class="fa-solid fa-shield-halved"></i></div><h3>MFA</h3><p>Activa autenticaci√≥n multifactor en servicios importantes.</p></article>
          <article class="cyber-card"><div class="cyber-icon"><i class="fa-solid fa-arrow-rotate-right"></i></div><h3>ACTUALIZA</h3><p>Mant√©n sistema y aplicaciones con los √∫ltimos parches de seguridad.</p></article>
          <article class="cyber-card"><div class="cyber-icon"><i class="fa-solid fa-shield-virus"></i></div><h3>ANTIVIRUS</h3><p>Instala y actualiza protecci√≥n antimalware donde proceda.</p></article>
          <article class="cyber-card"><div class="cyber-icon"><i class="fa-solid fa-copy"></i></div><h3>BACKUPS</h3><p>Realiza copias de seguridad peri√≥dicas y prueba restaurarlas.</p></article>
          <article class="cyber-card"><div class="cyber-icon"><i class="fa-regular fa-envelope"></i></div><h3>CUIDADO CON EMAILS</h3><p>No abras enlaces ni archivos de remitentes desconocidos; confirma antes.</p></article>
          <article class="cyber-card"><div class="cyber-icon"><i class="fa-solid fa-user-shield"></i></div><h3>PRIVACIDAD</h3><p>Revisa ajustes de privacidad y comparte lo m√≠nimo necesario en redes.</p></article>
          <article class="cyber-card"><div class="cyber-icon"><i class="fa-solid fa-wifi"></i></div><h3>REDES SEGURAS</h3><p>Evita Wi-Fi p√∫blicas para tr√°mites sensibles o usa VPN confiable.</p></article>
          <article class="cyber-card"><div class="cyber-icon"><i class="fa-solid fa-right-from-bracket"></i></div><h3>CIERRA SESI√ìN</h3><p>Descon√©ctate en equipos compartidos y bloquea dispositivos al ausentarte.</p></article>
          <article class="cyber-card"><div class="cyber-icon"><i class="fa-solid fa-chalkboard-user"></i></div><h3>INF√ìRMATE</h3><p>Consulta a responsables TI o fuentes oficiales ante dudas o incidentes.</p></article>
        </section>

        <div style="max-width:1100px;margin:42px auto 0;padding:6px 18px;">
          <h2 class="section-title">VISOR DE FOTOS</h2>
          <p class="section-sub">Haz clic en una imagen para verla.</p>
          <div style="display:flex;gap:12px;flex-wrap:wrap;">
            <button class="cyber-card visible" style="min-width:260px;cursor:pointer" data-image="https://drive.google.com/uc?export=view&id=1xPaqrSBADHyoigmlWjfOzqelXhZjTzgF">
              <div style="display:flex;gap:12px;align-items:center">
                <div class="cyber-icon"><i class="fa-solid fa-image"></i></div>
                <div><h3 style="margin:0">Foto 1</h3><p style="margin:6px 0 0;color:#dff7fb;font-size:0.92rem">Abrir imagen proveniente de Drive</p></div>
              </div>
            </button>

            <button class="cyber-card visible" style="min-width:260px;cursor:pointer" data-image="https://drive.google.com/uc?export=view&id=1hbnC6Waz5MnXrzdQIppWfcA2_Pde_ms9">
              <div style="display:flex;gap:12px;align-items:center">
                <div class="cyber-icon"><i class="fa-solid fa-photo-film"></i></div>
                <div><h3 style="margin:0">Foto 2</h3><p style="margin:6px 0 0;color:#dff7fb;font-size:0.92rem">Abrir imagen proveniente de Drive</p></div>
              </div>
            </button>
          </div>
        </div>

        <div id="lightbox" class="lightbox" role="dialog" aria-hidden="true" aria-label="Visor de imagen">
          <div class="frame" role="document">
            <button class="close" aria-label="Cerrar visor" id="lb-close"><i class="fa-solid fa-xmark"></i></button>
            <iframe id="lb-frame" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
          </div>
        </div>

        <aside class="refs" aria-label="Referencias recomendadas">
          <strong>Sugerencias y referencias √∫tiles</strong>
          <ul style="margin:12px 0 0 18px; color:var(--muted)">
            <li><a href="https://www.ibm.com/es-es/topics/cybersecurity" target="_blank" rel="noopener">IBM - Qu√© es la ciberseguridad</a></li>
            <li><a href="https://www.incibe.es/" target="_blank" rel="noopener">INCIBE - Instituto Nacional de Ciberseguridad (Espa√±a)</a></li>
            <li><a href="https://www.pantallasamigas.net/" target="_blank" rel="noopener">PantallasAmigas - recursos para menores y familias</a></li>
          </ul>
        </aside>

        <footer style="text-align:center;margin-top:40px;color:var(--text-secondary)">Hecho para clase</footer>
      </div>
    </div>
  </div>

  <script>
    // Variables globales
    let charts = {};
    let originalData = {};
    let simulatedData = null;
    let iaModeActive = false;

    // Datos
    const industryData = {
      years: [2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025],
      scores: {
        aaa:  [88,87,86,85,84,83,82,82,81,80,79,78,77,76,75,74,73,72,71,71,70,69,68,67,66,65],
        aa:   [35,36,38,39,41,42,44,45,47,48,50,52,54,56,58,60,62,64,76,75,74,73,72,70,69,68],
        indie:[15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90]
      },
      problems: [
        "Modelo retail, primeros DRM; industria AAA en expansi√≥n controlada",
        "Modelo retail, primeros DRM; industria AAA en expansi√≥n controlada",
        "Modelo retail, primeros DRM; industria AAA en expansi√≥n controlada",
        "Modelo retail, primeros DRM; industria AAA en expansi√≥n controlada",
        "Caso 'EA Spouse' revel√≥ abusos laborales; inicio del debate sobre el crunch.",
        "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
        "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
        "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
        "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
        "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
        "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
        "Altos costes de desarrollo AAA, brecha consola/PC, crisis de creatividad",
        "Microtransacciones emergentes, servicios en vivo, menos riesgo creativo",
        "Microtransacciones emergentes, servicios en vivo, menos riesgo creativo",
        "Microtransacciones emergentes, servicios en vivo, menos riesgo creativo",
        "Microtransacciones emergentes, servicios en vivo, menos riesgo creativo",
        "Microtransacciones emergentes, servicios en vivo, menos riesgo creativo",
        "Loot boxes, monetizaci√≥n agresiva, casos de crunch masivos",
        "Loot boxes, monetizaci√≥n agresiva, casos de crunch masivos",
        "Loot boxes, monetizaci√≥n agresiva, casos de crunch masivos",
        "Live service dominante, fusiones, p√©rdida de identidad AAA",
        "Live service dominante, fusiones, p√©rdida de identidad AAA",
        "Live service dominante, fusiones, p√©rdida de identidad AAA, despidos masivos",
        "Despidos masivos, cierres de estudios, auge de indies y AA de calidad",
        "Despidos masivos, cierres de estudios, auge de indies y AA de calidad",
        "Despidos masivos, cierres de estudios, auge de indies y AA de calidad"
      ],
      examples: {
        aaa: ["The Sims","Grand Theft Auto III","Grand Theft Auto: Vice City","Call of Duty (2003)","Half-Life 2","God of War (2005)","The Elder Scrolls IV: Oblivion","Halo 3","Fallout 3","Call of Duty: Modern Warfare 2","Red Dead Redemption","The Elder Scrolls V: Skyrim","Diablo III","Grand Theft Auto V","Destiny","The Witcher 3: Wild Hunt","Overwatch","Call of Duty: WWII","Red Dead Redemption 2","Sekiro: Shadows Die Twice","Animal Crossing: New Horizons","Call of Duty: Vanguard","Elden Ring","The Legend of Zelda: Tears of the Kingdom","Baldur's Gate 3","Spider-Man 2"],
        aa:  ["Tony Hawk's Pro Skater 2","Halo: Combat Evolved","Metroid Prime","Prince of Persia: The Sands of Time","Shadow of the Colossus","Okami","BioShock","Left 4 Dead","Demon's Souls","Alan Wake","Dark Souls","Borderlands 2","The Last of Us","Dragon Age: Inquisition","Fallout 4","Inside","Hellblade: Senua's Sacrifice","Monster Hunter: World","Control","The Last of Us Part II","Returnal","Disco Elysium: The Final Cut","Alan Wake 2","Hi-Fi Rush","Senua's Saga: Hellblade II"],
        indie:["-","-","-","-","Braid","-","-","-","Braid","Minecraft (alpha)","Limbo","Fez","FTL: Faster Than Light","Papers, Please","Shovel Knight","Undertale","Stardew Valley","Hollow Knight","Celeste","Disco Elysium","Hades","Valheim","Vampire Survivors","Sea of Stars","Dave the Diver","Hollow Knight: Silksong"]
      },
      projections: {
        years:[2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2041,2042,2043,2044,2045,2046,2047,2048,2049,2050],
        aaa: [64.4,63.32,62.41,61.50,60.59,59.68,58.77,57.86,56.96,56.05,55.14,54.23,53.32,52.41,51.50,50.59,49.68,48.77,47.86,46.96,46.05,45.14,44.23,43.32,42.41],
        aa:  [79.2,80.2,82.2,83.2,85.2,86.2,88.2,89.2,91.2,92.2,94.2,96.2,98.2,100,100,100,100,100,100,100,100,100,100,100,100],
        indie:[93,96,99,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100]
      }
    };

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', function() {
      originalData = JSON.parse(JSON.stringify(industryData));
      initializeCharts();
      populateTable();
      generateInsights();
      setupEventListeners();
      initCyberCards();
    });

    // Gesti√≥n de pesta√±as
    function switchTab(tabName) {
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      event.target.closest('.tab-button').classList.add('active');
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById(tabName + '-tab').classList.add('active');
    }

    // ==================== Reemplazar toggleIAMode y callKimiAPI ====================
    async function toggleIAMode() {
      const btn = document.getElementById('iaModeBtn');
      const indicator = document.getElementById('iaModeIndicator');
      const exportBtn = document.getElementById('exportBtn');

      if (!iaModeActive) {
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generando simulaci√≥n...';
        btn.disabled = true;

        try {
          simulatedData = await callKimiAPI();
          if (simulatedData) {
            iaModeActive = true;
            indicator.style.display = 'block';
            btn.innerHTML = '‚ö† Desactivar IA';
            btn.disabled = false;
            exportBtn.disabled = true;
            updateAllCharts(simulatedData);
            showNotification('‚úÖ Simulaci√≥n IA activada. Datos temporales cargados.', 'success');
          } else {
            throw new Error('Datos no v√°lidos (respuesta vac√≠a o malformada)');
          }
        } catch (error) {
          console.error('Error en IA:', error);
          showNotification('‚ùå Error al generar simulaci√≥n. Intenta de nuevo.', 'error');
          btn.innerHTML = 'ü§ñ Activar Simulaci√≥n IA';
          btn.disabled = false;
        }
      } else {
        iaModeActive = false;
        simulatedData = null;
        indicator.style.display = 'none';
        btn.innerHTML = 'ü§ñ Activar Simulaci√≥n IA';
        btn.disabled = false;
        exportBtn.disabled = false;
        updateAllCharts(originalData);
        showNotification('üìä Modo original restaurado.', 'info');
      }
    }

    async function callKimiAPI() {
      const prompt = `
Eres un analista de videojuegos senior. Genera datos REALISTAS y COHERENTES sobre la 
industria gaming 2000-2025 siguiendo EXACTAMENTE este formato JSON:

{
"years": [2000,2001,...,2025],
"scores": {
  "aaa": [88,87,...,65],
  "aa": [35,36,...,68],
  "indie": [15,18,...,90]
},
"problems": ["texto problema a√±o 2000", "texto problema a√±o 2001", ...],
"examples": {
  "aaa": ["Juego AAA 2000", "Juego AAA 2001", ...],
  "aa": ["Juego AA 2000", "Juego AA 2001", ...],
  "indie": ["Juego Indie 2000", "Juego Indie 2001", ...]
},
"projections": {
  "years": [2026,...,2050],
  "aaa": [64.4,...,42.41],
  "aa": [79.2,...,100],
  "indie": [93,...,100]
}
}

REGLAS:
1. AAA debe mostrar DECLIVE gradual (85‚Üí65)
2. AA debe mostrar CRECIMIENTO estable (35‚Üí68)
3. Indies deben mostrar EXPLOSI√ìN (15‚Üí90)
4. Los problemas deben reflejar la evoluci√≥n real: retail ‚Üí crunch ‚Üí microtransacciones ‚Üí crisis laboral
5. Los ejemplos deben ser juegos REALISTAS por a√±o
6. Las proyecciones deben ser coherentes con tendencias
7. DEVUELVE SOLO EL JSON, sin texto adicional
8. Asegura que todos los arrays tengan EXACTAMENTE 26 elementos para datos hist√≥ricos y 25 para proyecciones
`;

      try {
        const response = await Promise.race([
          puter.ai.chat({
            model: 'moonshotai/kimi-k2',
            messages: [{ role: 'user', content: prompt }],
            temperature: 0.7,
            max_tokens: 4000
          }),
          new Promise((_, reject) => setTimeout(() => reject(new Error('API timeout')), 25000))
        ]);

        let raw = null;
        if (response?.choices && response.choices.length > 0) {
          raw = response.choices[0].message?.content ?? response.choices[0].text ?? null;
        }
        raw = raw ?? response?.output_text ?? response?.text ?? (typeof response === 'string' ? response : null);

        if (!raw) {
          console.error('Respuesta sin texto:', response);
          return null;
        }

        let jsonData = null;
        try {
          jsonData = JSON.parse(raw);
        } catch (e) {
          const match = raw.match(/\{[\s\S]*\}/);
          if (match) {
            try { jsonData = JSON.parse(match[0]); }
            catch (e2) { console.error('Fallo parseando JSON extra√≠do:', e2, match[0]); return null; }
          } else {
            console.error('No se encontr√≥ JSON en la respuesta:', raw);
            return null;
          }
        }

        if (
          jsonData &&
          Array.isArray(jsonData.years) && jsonData.years.length === 26 &&
          jsonData.scores &&
          Array.isArray(jsonData.scores.aaa) && jsonData.scores.aaa.length === 26 &&
          Array.isArray(jsonData.scores.aa) && jsonData.scores.aa.length === 26 &&
          Array.isArray(jsonData.scores.indie) && jsonData.scores.indie.length === 26 &&
          Array.isArray(jsonData.problems) && jsonData.problems.length === 26
        ) {
          return jsonData;
        } else {
          console.error('Estructura de datos inv√°lida o incompleta:', jsonData);
          return null;
        }
      } catch (error) {
        console.error('Error en callKimiAPI:', error);
        return null;
      }
    }

    // Actualizar dashboards
    function updateAllCharts(data) {
      const years = data.years;
      const scores = data.scores;

      document.getElementById('aaaCurrent').textContent = scores.aaa[scores.aaa.length - 1];
      document.getElementById('aaCurrent').textContent   = scores.aa[scores.aa.length - 1];
      document.getElementById('indieCurrent').textContent= scores.indie[scores.indie.length - 1];

      charts.trend.data.labels = years;
      charts.trend.data.datasets[0].data = scores.aaa;
      charts.trend.data.datasets[1].data = scores.aa;
      charts.trend.data.datasets[2].data = scores.indie;
      charts.trend.update();

      const filteredIndices = years.map((_, i) => i).filter(i => i % 5 === 0);
      charts.comparison.data.labels = filteredIndices.map(i => years[i]);
      charts.comparison.data.datasets[0].data = filteredIndices.map(i => scores.aaa[i]);
      charts.comparison.data.datasets[1].data = filteredIndices.map(i => scores.aa[i]);
      charts.comparison.data.datasets[2].data = filteredIndices.map(i => scores.indie[i]);
      charts.comparison.update();

      populateTableWithData(data);
    }

    // Tabla
    function populateTableWithData(data) {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = "";
      data.years.forEach((year, index) => {
        const row = document.createElement('tr');
        const trendAAA = index > 0 ? data.scores.aaa[index]   - data.scores.aaa[index-1]   : 0;
        const trendAA  = index > 0 ? data.scores.aa[index]    - data.scores.aa[index-1]    : 0;
        const trendInd = index > 0 ? data.scores.indie[index] - data.scores.indie[index-1] : 0;

        row.innerHTML = `
          <td><strong>${year}</strong></td>
          <td>${data.scores.aaa[index]} <span class="trend-indicator ${trendAAA >= 0 ? 'trend-up' : 'trend-down'}"></span></td>
          <td>${data.scores.aa[index]} <span class="trend-indicator ${trendAA  >= 0 ? 'trend-up' : 'trend-down'}"></span></td>
          <td>${data.scores.indie[index]} <span class="trend-indicator ${trendInd >= 0 ? 'trend-up' : 'trend-down'}"></span></td>
          <td>${data.problems[index]}</td>
          <td>${data.examples?.aaa?.[index] ?? '-'}</td>
          <td>${data.examples?.aa?.[index] ?? '-'}</td>
          <td>${data.examples?.indie?.[index] ?? '-'}</td>
          <td>${year <= 2004 ? 'Expansi√≥n' : year <= 2012 ? 'Crisis' : year <= 2020 ? 'Monetizaci√≥n' : 'Reestructuraci√≥n'}</td>
        `;
        tbody.appendChild(row);
      });
    }
    function populateTable() { populateTableWithData(industryData); }

    function showNotification(message, type) {
      const notification = document.createElement('div');
      notification.style.position = 'fixed';
      notification.style.top = '20px';
      notification.style.right = '20px';
      notification.style.padding = '16px 24px';
      notification.style.borderRadius = '8px';
      notification.style.color = 'white';
      notification.style.fontWeight = '600';
      notification.style.zIndex = '10000';
      notification.style.maxWidth = '300px';
      notification.style.boxShadow = '0 8px 32px rgba(0,0,0,0.3)';
      notification.style.transition = 'transform 0.3s, opacity 0.3s';

      if (type === 'success') notification.style.background = 'linear-gradient(135deg, #10B981, #059669)';
      else if (type === 'error') notification.style.background = 'linear-gradient(135deg, #EF4444, #DC2626)';
      else if (type === 'warning') notification.style.background = 'linear-gradient(135deg, #F59E0B, #D97706)';
      else notification.style.background = 'linear-gradient(135deg, #3B82F6, #2563EB)';

      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-20px)';
        setTimeout(() => notification.remove(), 300);
      }, 4000);
    }

    // Eventos UI
    function setupEventListeners() {
      document.getElementById('yearRange').addEventListener('change', filterData);
      document.getElementById('gameType').addEventListener('change', filterData);
      document.getElementById('analysisFocus').addEventListener('change', updateCharts);
      document.getElementById('searchTable').addEventListener('input', searchTable);
    }

    function filterData() {
      if (iaModeActive) {
        showNotification('‚Ñπ Los filtros est√°n deshabilitados en modo IA.', 'info');
        return;
      }
      const yearRange = document.getElementById('yearRange').value;
      const gameType = document.getElementById('gameType').value;
      console.log('Filtrando:', yearRange, gameType);
      // Aqu√≠ podr√≠as aplicar filtros sobre originalData y llamar updateAllCharts(dataFiltrada)
    }

    function updateCharts() {
      const focus = document.getElementById('analysisFocus').value;
      console.log('Cambiando foco a:', focus);
      // Aqu√≠ podr√≠as cambiar el modo de visualizaci√≥n seg√∫n focus
    }

    function searchTable() {
      const searchTerm = document.getElementById('searchTable').value.toLowerCase();
      const rows = document.querySelectorAll('#tableBody tr');
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    }

    function exportData() {
      if (iaModeActive) {
        showNotification('¬°Exportar no est√° disponible en modo IA.', 'warning');
        return;
      }
      const dataToExport = {
        metadata: {
          exported: new Date().toISOString(),
          source: 'AAA vs Indie Industry Dashboard',
          range: '2000-2025',
          type: 'original_data'
        },
        data: originalData
      };
      const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `gaming_industry_analysis_${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showNotification('Datos exportados correctamente.', 'success');
    }

    function resetFilters() {
      document.getElementById('yearRange').value = 'all';
      document.getElementById('gameType').value = 'all';
      document.getElementById('analysisFocus').value = 'scores';
      document.getElementById('searchTable').value = '';
      searchTable();
      if (iaModeActive) toggleIAMode();
    }

    // Charts
    function initializeCharts() {
      // Trend
      const trendCtx = document.getElementById('trendChart').getContext('2d');
      charts.trend = new Chart(trendCtx, {
        type: 'line',
        data: {
          labels: industryData.years,
          datasets: [
            { label: 'AAA',   data: industryData.scores.aaa,   borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.1)', borderWidth: 3, tension: 0.4, pointRadius: 4 },
            { label: 'AA',    data: industryData.scores.aa,    borderColor: '#F59E0B', backgroundColor: 'rgba(245,158,11,0.1)', borderWidth: 3, tension: 0.4, pointRadius: 4 },
            { label: 'Indie', data: industryData.scores.indie, borderColor: '#10B981', backgroundColor: 'rgba(16,185,129,0.1)', borderWidth: 3, tension: 0.4, pointRadius: 4 }
          ]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          interaction: { mode: 'index', intersect: false },
          plugins: {
            legend: { labels: { color: '#F1F5F9', font: { size: 12 } } },
            tooltip: { backgroundColor: '#1E293B', titleColor: '#F1F5F9', bodyColor: '#E2E8F0', borderColor: '#334155', borderWidth: 1 }
          },
          scales: {
            y: { beginAtZero: true, max: 100, ticks: { color: '#94A3B8' }, grid: { color: 'rgba(255,255,255,0.05)' } },
            x: { ticks: { color: '#94A3B8' }, grid: { color: 'rgba(255,255,255,0.05)' } }
          }
        }
      });

      // Radar comparison
      const comparisonCtx = document.getElementById('comparisonChart').getContext('2d');
      charts.comparison = new Chart(comparisonCtx, {
        type: 'radar',
        data: {
          labels: industryData.years.filter((_, i) => i % 5 === 0),
          datasets: [
            { label: 'AAA',   data: industryData.scores.aaa.filter((_, i) => i % 5 === 0), borderColor: '#EF4444', backgroundColor: 'rgba(239,68,68,0.2)' },
            { label: 'AA',    data: industryData.scores.aa.filter((_, i) => i % 5 === 0),   borderColor: '#F59E0B', backgroundColor: 'rgba(245,158,11,0.2)' },
            { label: 'Indie', data: industryData.scores.indie.filter((_, i) => i % 5 === 0), borderColor: '#10B981', backgroundColor: 'rgba(16,185,129,0.2)' }
          ]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: {
            r: { beginAtZero: true, max: 100, ticks: { color: '#94A3B8' }, grid: { color: 'rgba(255,255,255,0.1)' }, pointLabels: { color: '#E2E8F0' } }
          },
          plugins: { legend: { labels: { color: '#F1F5F9' } } }
        }
      });

      // Heatmap problems (stacked bars)
      const heatmapCtx = document.getElementById('heatmapChart').getContext('2d');
      const categories = ['Retail/DRM','Crunch','Costes Altos','Microtransacciones','Loot Boxes','Live Service','Despidos','Crisis Creativa'];
      const problemData = industryData.problems.map(p => {
        const t = p.toLowerCase();
        const scores = {
          retail: t.includes('retail') || t.includes('drm') ? 1 : 0,
          crunch: t.includes('crunch') || t.includes('ea spouse') ? 1 : 0,
          costs:  t.includes('costes') || t.includes('altos costes') ? 1 : 0,
          micro:  t.includes('microtransacciones') ? 1 : 0,
          loot:   t.includes('loot boxes') ? 1 : 0,
          live:   t.includes('live service') || t.includes('servicios en vivo') ? 1 : 0,
          layoffs:t.includes('despidos') ? 1 : 0,
          creative:t.includes('creatividad') || t.includes('crisis de creatividad') ? 1 : 0
        };
        return Object.values(scores);
      });

      charts.heatmap = new Chart(heatmapCtx, {
        type: 'bar',
        data: {
          labels: industryData.years,
          datasets: categories.map((cat, i) => ({
            label: cat,
            data: problemData.map(row => row[i]),
            backgroundColor: `rgba(59,130,246, ${0.2 + (i * 0.08)})`,
            borderColor: `rgba(59,130,246, ${0.4 + (i * 0.08)})`,
            borderWidth: 1
          }))
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: {
            x: { stacked: true, ticks: { color: '#94A3B8' } },
            y: { stacked: true, ticks: { color: '#94A3B8' } }
          },
          plugins: { legend: { labels: { color: '#F1F5F9' } } }
        }
      });

      // Growth
      const growthCtx = document.getElementById('growthChart').getContext('2d');
      const growthData = {
        aaa: industryData.scores.aaa.map(score => ((score - industryData.scores.aaa[0]) / industryData.scores.aaa[0] * 100)),
        aa:  industryData.scores.aa.map(score  => ((score - industryData.scores.aa[0])  / industryData.scores.aa[0]  * 100)),
        indie: industryData.scores.indie.map(score => ((score - industryData.scores.indie[0]) / industryData.scores.indie[0] * 100))
      };
      charts.growth = new Chart(growthCtx, {
        type: 'bar',
        data: {
          labels: industryData.years,
          datasets: [
            { label: 'AAA',   data: growthData.aaa,   backgroundColor: '#EF4444' },
            { label: 'AA',    data: growthData.aa,    backgroundColor: '#F59E0B' },
            { label: 'Indie', data: growthData.indie, backgroundColor: '#10B981' }
          ]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          scales: {
            y: { ticks: { color: '#94A3B8', callback: value => value + '%' }, grid: { color: 'rgba(255,255,255,0.05)' } },
            x: { ticks: { color: '#94A3B8' } }
          },
          plugins: {
            legend: { labels: { color: '#F1F5F9' } },
            tooltip: { callbacks: { label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y.toFixed(1)}%` } }
          }
        }
      });

      // Projections
      const projectionCtx = document.getElementById('projectionChart').getContext('2d');
      charts.projection = new Chart(projectionCtx, {
        type: 'line',
        data: {
          labels: [...industryData.years, ...industryData.projections.years],
          datasets: [
            { label: 'AAA (Hist√≥rico)', data: [...industryData.scores.aaa, ...Array(25).fill(null)], borderColor: '#EF4444', borderWidth: 3 },
            { label: 'AAA (Proyecci√≥n)', data: [...Array(26).fill(null), ...industryData.projections.aaa], borderColor: '#EF4444', borderWidth: 2, borderDash: [5,5], pointRadius: 0 },
            { label: 'AA (Hist√≥rico)', data: [...industryData.scores.aa, ...Array(25).fill(null)], borderColor: '#F59E0B', borderWidth: 3 },
            { label: 'AA (Proyecci√≥n)', data: [...Array(26).fill(null), ...industryData.projections.aa], borderColor: '#F59E0B', borderWidth: 2, borderDash: [5,5], pointRadius: 0 },
            { label: 'Indie (Hist√≥rico)', data: [...industryData.scores.indie, ...Array(25).fill(null)], borderColor: '#10B981', borderWidth: 3 },
            { label: 'Indie (Proyecci√≥n)', data: [...Array(26).fill(null), ...industryData.projections.indie], borderColor: '#10B981', borderWidth: 2, borderDash: [5,5], pointRadius: 0 }
          ]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: { legend: { labels: { color: '#F1F5F9' } } },
          scales: {
            y: { beginAtZero: true, max: 100, ticks: { color: '#94A3B8' } },
            x: { ticks: { color: '#94A3B8' } }
          }
        }
      });
    }

    // Insights
    function generateInsights() {
      const insights = [
        { title: "Declive Sistem√°tico AAA", description: "Las notas de AAA han ca√≠do 26.1% desde 2000, perdiendo 1 punto/a√±o promedio. La tendencia se acelera post-2012.", severity: "high" },
        { title: "Eclosi√≥n Indie", description: "Los indies han crecido 500% en 25 a√±os, pasando de 15 a 90 puntos. Superan a AAA desde 2022.", severity: "medium" },
        { title: "Renacimiento AA", description: "El segmento AA resurgi√≥ en 2018 (+35% vs 2017), con t√≠tulos como Hellblade y Monster Hunter.", severity: "medium" },
        { title: "Crisis Laboral", description: "Los problemas de crunch y despidos se multiplican desde 2020, coincidiendo con la ca√≠da de calidad AAA.", severity: "high" }
      ];
      const grid = document.getElementById('insightsGrid');
      grid.innerHTML = "";
      insights.forEach(insight => {
        const card = document.createElement('div');
        card.className = 'insight-card';
        card.innerHTML = `
          <h4>${insight.title}</h4>
          <p style="font-size:0.9rem;opacity:0.9">${insight.description}</p>
          <span style="font-size:0.75rem;opacity:0.7; margin-top:10px; display:inline-block;">Prioridad: ${insight.severity === 'high' ? 'Alta' : 'Media'}</span>
        `;
        grid.appendChild(card);
      });
    }

    // Ciberseguridad: tarjetas y lightbox
    function initCyberCards() {
      const gridCards = document.querySelectorAll('.cyber-card');
      const obs = new IntersectionObserver((entries, o) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const idx = Array.from(gridCards).indexOf(entry.target);
            const baseRange = 8 + (idx % 3) * 4;
            const range = baseRange + Math.round(Math.random() * 6) + 'px';
            const dur = (3.6 + Math.random() * 2.2).toFixed(2) + 's';
            const delay = (Math.random() * 500).toFixed(0) + 'ms';
            entry.target.style.setProperty('--dance-range', range);
            entry.target.style.setProperty('--dance-dur', dur);
            entry.target.style.animationDelay = delay;
            entry.target.classList.add('visible', 'dance');
            o.unobserve(entry.target);
          }
        });
      }, { threshold: 0.12 });
      gridCards.forEach(c => obs.observe(c));

      const lb = document.getElementById('lightbox');
      const lbFrame = document.getElementById('lb-frame');
      const lbClose = document.getElementById('lb-close');

      document.querySelectorAll('[data-image]').forEach(btn => {
        btn.addEventListener('click', () => {
          const url = btn.dataset.image;
          const allowed = [
            'https://drive.google.com/uc?export=view&id=1xPaqrSBADHyoigmlWjfOzqelXhZjTzgF',
            'https://drive.google.com/uc?export=view&id=1hbnC6Waz5MnXrzdQIppWfcA2_Pde_ms9'
          ];
          if (!allowed.includes(url)) {
            alert('Imagen no permitida');
            return;
          }
          lbFrame.src = url;
          lb.classList.add('active');
          lb.setAttribute('aria-hidden', 'false');
          document.body.style.overflow = 'hidden';
        });
        btn.setAttribute('tabindex', '0');
        btn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            btn.click();
          }
        });
      });

      function closeLB() {
        lbFrame.src = "";
        lb.classList.remove('active');
        lb.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = "";
      }
      lbClose.addEventListener('click', closeLB);
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && lb.classList.contains('active')) closeLB(); });
      lb.addEventListener('click', (e) => { if (e.target === lb) closeLB(); });

      const allCards = document.querySelectorAll('.cyber-card');
      allCards.forEach(card => {
        card.addEventListener('mousemove', (e) => {
          const rect = card.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          const cx = rect.width / 2;
          const cy = rect.height / 2;
          const dx = (x - cx) / cx;
          const dy = (y - cy) / cy;
          const rx = (dy * 6).toFixed(2);
          const ry = (-dx * 8).toFixed(2);
          card.style.transform = `translateY(-18px) scale(1.06) rotateX(${rx}deg) rotateY(${ry}deg) rotateZ(-0.6deg)`;
        });
        card.addEventListener('mouseleave', () => { card.style.transform = ""; });

        const tinyShake = () => {
          if (card.matches(':hover')) { setTimeout(tinyShake, 1000 + Math.random() * 2000); return; }
          card.animate([
            { transform: `translate(${(Math.random()*6-3).toFixed(2)}px, ${(Math.random()*4-2).toFixed(2)}px) rotate(${(Math.random()*1-0.5).toFixed(2)}deg)` },
            { transform: 'translate(0px, 0px) rotate(0deg)' }
          ], { duration: 420 + Math.random() * 600, easing: 'ease-in-out' });
          setTimeout(tinyShake, 1500 + Math.random() * 2600);
        };
        setTimeout(tinyShake, 400 + Math.random() * 900);
      });
    }
  </script>
</body>
</html>
